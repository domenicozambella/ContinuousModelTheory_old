\documentclass[12pt,letterpaper,oneside,reqno]{amsart}

\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{comment}
\usepackage{tikz}
\usepackage{xcolor}
\usepackage{datetime2} 
\usepackage{hyperref}

\usepackage[margin=1in]{geometry}
\usepackage{mathtools}
\usepackage{enumitem}
\usepackage{calc}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage[mathcal]{euscript}
%\usepackage{bbm}
%\usepackage{latexsym}
\usepackage{mathrsfs}
%\usepackage{stmaryrd}
\usepackage{stix}
\usepackage{dsfont}
\newcommand*{\TakeFourierOrnament}[1]{{%
\fontencoding{U}\fontfamily{futs}\selectfont\char#1}}
\renewcommand*{\danger}{\TakeFourierOrnament{66}}
\parindent0ex
\parskip1.2ex

\newcommand{\mylabel}[1]{{#1}\hfill}
\renewenvironment{itemize}
  {\begin{list}{$\triangleright$}{%
   \setlength{\parskip}{0mm}
   \setlength{\topsep}{.2\baselineskip}
   \setlength{\rightmargin}{0mm}
   \setlength{\listparindent}{0mm}
   \setlength{\itemindent}{0mm}
   \setlength{\labelwidth}{3ex}
   \setlength{\itemsep}{.2\baselineskip}
   \setlength{\parsep}{.2\baselineskip}
   \setlength{\partopsep}{0mm}
   \setlength{\labelsep}{1ex}
   \setlength{\leftmargin}{\labelwidth+\labelsep}
   \let\makelabel\mylabel}}{%
   \end{list}}

\newtheoremstyle{plain}% 〈name〉
{\parskip}% 〈Space above〉1
{\parskip}% 〈Space below 〉1
{\color{brown!20!red!40!black}}% 〈Body font〉
{}% 〈Indent amount〉2
{\bfseries}% 〈Theorem head font〉
{.}% 〈Punctuation after theorem head 〉
{.5em}% 〈Space after theorem head 〉3
{\llap{\thmnumber{#2}\hskip2mm}\thmname{#1}\thmnote{\kern1ex\bfseries(#3)}}% 〈Theorem head spec (can be left empty, meaning ‘normal’ )
\theoremstyle{plain}
\newtheorem{theorem}{Theorem}%[section]
\newtheorem{specialtheorem}{Theorem}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{fact}[theorem]{Fact}
\newtheorem{corollary}[theorem]{Corollary}


\newtheorem{conjecture}[theorem]{Conjecture}
\newtheorem{question}[theorem]{Question}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{definitions}[theorem]{Definitions}
\newtheorem{example}[theorem]{Example}
\newtheorem{examples}[theorem]{Examples}
\newtheorem{convention}[theorem]{Convention}
\newtheorem{conventions}[theorem]{Conventions}
\newtheorem{notation}[theorem]{Notation}

\newtheorem{remark}[theorem]{Remark}
\newtheorem{remarks}[theorem]{Remarks}

\theoremstyle{remark}
\newtheorem*{claim}{Claim}

\renewcommand*{\emph}[1]{%
   \smash{\tikz[baseline]\node[rectangle, fill=olive!25, rounded corners, inner xsep=0.5ex, inner ysep=0.2ex, anchor=base, minimum height = 2.7ex]{#1};}}

\linespread{1.2}
\begin{document}
\title{Continuous logic for the classical logician}
\hfill\texttt{Branch: Logica-Discreta \ \DTMnow}\bigskip
\maketitle
\raggedbottom
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{A class of structures}\label{uno}

\def\ceq#1#2#3{\parbox[t]{43ex}{$\displaystyle #1$}\parbox{5ex}{\hfil $#2$}{$\displaystyle #3$}}

\begin{definition}\label{def_1}
  In these notes we deal with 3-sorted%
  \footnote{In some examples it may be more natural to use $(n+n'+1)$-sorted structures ${\EuScript M}=\langle \breve M_1,\dots,\breve M_n,M_1,\dots,M_{n'},\mathds{R}\rangle$. The generalization is straightforeward.} 
  structures of the form ${\EuScript M}=\langle \breve M,M,\mathds{R}\rangle$.
  The language and its interpretation are subject to the following conditions.
  \begin{itemize}
  \item[1.] Functions may only have one of the following sorts (for any $m,n\in\omega$)
  \begin{itemize}
    \item[a.] $\mathds{R}^n\to\mathds{R}$
    \item[b.] $\breve M^n\times{M}^m\to\textrm{any of } \breve M,\ M,\textrm{ or }\mathds{R}$
    % \item[c.] $\breve M^n\times{M}^m\to M$
    % \item[d.] $\breve M^n\times{M}^m\to\mathds{R}$
  \end{itemize}
  \item[2.] There is a symbol for very (total) continuous functions $\mathds{R}^n\to\mathds{R}$.
  \item[3.] The (functions that interpret the) terms of sort $\breve M^n\to\mathds{R}$ have \textit{bounded\/} range.
  \item[4.] Every element of $M$ is the image of some term of sort $\breve M^n\to M$.  
  \item[5.] There is only one predicate; it has sort $\mathds{R}$ and is interpreted as $x\le0$.
  \end{itemize}
\end{definition}

We call $\breve M$ the \emph{unit ball\/} of ${\EuScript M}$.
The terminology is inspired by the example below.

The language is denoted by $\mathds{L}$.

\begin{definition}
  We write \emph{$\mathds{T}(A)$\/} for the set of terms of sort $\breve M^n\times\mathds{R}^m\to\mathds{R}$ and parameters in $A\subseteq \breve M$.
  Up to equivalence, these terms have the form $f(t(x),y)$ where $t(x)$ is a tuple of terms of sort $\breve M^{|x|}\to\mathds{R}$, the variables $y$ have sort $\mathds{R}$, and $f$ is a function $\mathds{R}^{|t|+|y|}\to\mathds{R}$.
\end{definition}

\begin{definition}
  We write \emph{$\mathds{L}(A)$\/} for the set of formulas obtained inductively as follows
  \begin{itemize}
  \item[i.] $\mathds{L}(A)$ contains the atomic formula $t\le0$ for every term $t\in\mathds{T}(A)$.
  \item[ii.] It is closed under the Boolean connectives $\wedge$, $\vee$, and the quantifiers $\forall$, $\exists$ of sort $\breve M$.
  \item[iii.] It is closed under the quantifier $\forall$ of sort $\mathds{R}$ relativized to any definable subset of $\mathds{R}$.
  \end{itemize}
\end{definition}

Note that in iii, definability, is with respect to the full first order language.
In particular, if $\varphi(x,\varepsilon)\in\mathds{L}(A)$, also $\forall\varepsilon{>}0\;\varphi(x,\varepsilon)\in\mathds{L}(A)$.

\begin{example}[Banach spaces]
  Given a Banach space  $M$ we define a structure ${\EuScript M}=\langle \breve M,M,\mathds{R}\rangle$ as follows.
  Let $\breve M=\{a\in M: \|a\|\le1\}$ be the closed unit ball of $M$.
  Besides the symbols mentioned above, $\mathds{L}$ contains a function symbol for the natural embedding ${\rm id}:\breve M\to M$.
  It also contains a symbol for the norm $\|\mbox-\|:M\to\mathds{R}$.
  Finally, $\mathds{L}$ contains the usual symbols of the language of vector spaces.
  These have sort ${M}^n\to M$, for the appropiate $n\in\{0,1,2\}$.
  Note that conditions 3 and 4 of Definition~\ref{def_1} are immediatly satisfied.
\end{example}

If $\varphi\in\mathds{L(A)}$ and $\varepsilon>0$ we write \emph{$\varphi_\varepsilon$\/} for the formula obtained by replacing in $\varphi$ the atomic formulas $t\le0$ with  $t-\varepsilon\le0$.
Note that $\varphi\to\varphi_\varepsilon$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Ultraproducts}\label{ultrapws}

% The content of this section can be generalized to ultraproducts at the cost of an extra index.
% We opt for the simpler variant as it suffices to prove the existence of saturated elementary extensions.

\def\ceq#1#2#3{\parbox[t]{20ex}{$\displaystyle #1$}\parbox{5ex}{\hfil $#2$}{$\displaystyle #3$}}


We recall some standard definitions about limits.
Let $I$ be a non-empty set.
Let $F$ be a filter on $I$.
If $f:I\to{\mathds R}$ and $\lambda\in{\mathds R}\cup\{\pm\infty\}$ we write

\hfil$\displaystyle \lim_{i\to F}f(i)=\lambda$

if $f^{-1}[A]\in F$ for every $A\subseteq{\mathds R}\cup\{\pm\infty\}$ that is a neighborhood of $\lambda$.
Such a $\lambda$ is unique and, when $F$ is an ultrafilter, it always exists.
When $f$ is bounded, $\lambda\in\mathds{R}$.

Let $I$ be an infinite set.
Let $\langle {\EuScript M}_i:i\in I\rangle$ be a sequence of structures, say  ${\EuScript M}_i=\langle \breve M_i,M_i,\mathds{R}\rangle$, that are \emph{uniformly bounded,} that is, the bounds in 3 of Definition~\ref{def_1} are the same for all ${\EuScript M}_i$.

Let $F$ be an ultrafilter on $I$.

\begin{definition}\label{def_ultraproduct}
  We define a structure \emph{${\EuScript N}=\langle\breve  N,N,\mathds{R}\rangle$\/} that we call the \emph{ultraproduct\/} of the models $\langle{\EuScript M}_i:i\in I\rangle$.
  \begin{itemize}
    \item[1.] $\breve N$ comprise the sequences $\hat a: I\to\bigcup_{i\in I}\breve M_i$ such that $\hat a\,i\in \breve M_i$.
    \item[2.] $N$ comprise the sequences $t^{\EuScript N}(\hat a)$ of the form $t^{{\EuScript M}_i}(\hat ai)$, where $t(x)$ is a term of sort $\breve M^n\to M$.
    \item[3.] If $f$ is a function of sort $\breve M^n\times{M}^m\to \breve M$ then $f^{\EuScript N}(\hat a,t^{{\EuScript N}}\big(\hat c)\big)$ is the sequence 
    $f^{{\EuScript M}_i}\big(\hat ai,t^{{\EuScript M}_i}(\hat ci)\big)$.
    \item[4.] Similarly when $f$ is of sort $\breve M^n\times{M}^m\to M$.
    \item[5.] If $f$ is a function of sort $\breve M^n\times{M}^m\to\mathds{R}$ then 
    $$
    f^{\EuScript N}\big(\hat a,t^{\EuScript N}(\hat c)\big)\ =\ \lim_{i\to F}f^{{\EuScript M}_i}\big(\hat ai,t^{{\EuScript M}_i}(\hat ci)\big).
    $$ 
  \end{itemize}
  As usual, if ${\EuScript M}_i={\EuScript M}$ for all $i\in I$, we say that ${\EuScript N}$ is an \emph{ultrapower\/} of ${\EuScript M}$.
\end{definition}

The limit in 5 of the definition above always exists because $F$ is an ultrafilter.
It is finite because all models ${\EuScript M}_i$ have the same bounds.

The following fact is easily proved by induction on the syntax.

\begin{fact}
  For every term of sort $\breve M^n\times{M}^m\to\mathds{R}$  
  $$
  f^{\EuScript N}\big(\hat a,t^{\EuScript N}(\hat c)\big)\ =\ \lim_{i\to F}f^{{\EuScript M}_i}\big(\hat ai,t^{{\EuScript M}_i}(\hat ci)\big).
  $$ 
\end{fact}

Finally, we prove 


\begin{proposition}[\L\v{o}\'s Theorem]
  Let ${\EuScript N}$ be as above and let $\varphi(x,y)\in\mathds{L}(A)$.
  Let $\hat a\in\breve N^{|x|}$.
  Then there is a function $u_{-}:\mathds{R}^+\to F$ such that for every $\lambda\in\mathds{R}^{|y|}$

  \ceq{1.\hfill {\EuScript N}\models\varphi(\hat a, \lambda)}
  {\Rightarrow}
  {u_\varepsilon\subseteq\big\{ i\in I\ :\ {\EuScript M}_i\models\varphi_\varepsilon(\hat ai,\lambda)\big\} \ \textrm{for every }\varepsilon>0.}

  \ceq{2.\hfill {\EuScript N}\not\models\varphi(\hat a, \lambda)}
  {\Rightarrow}
  {u_\varepsilon\subseteq\big\{ i\in I\ :\ {\EuScript M}_i\not\models\varphi_\varepsilon(\hat ai,\lambda)\big\} \ \textrm{for some }\varepsilon>0.}

\end{proposition}
\begin{proof}
  Without loss of generality, we can assume that $\Lambda$ is compact.
  Suppose that $\varphi(x,y)$ is atomic, say

  \ceq{\hfill\varphi(x,y)}
  {=}
  {f(t(x),\,y)\le0,} 
  
  where $t$ is a tuple of terms of sort  $\breve M^{|x|}\to\mathds{R}$ and $f$ is a continuous function $\mathds{R}^{|t|+|y|}\to\mathds{R}$.

  Let $\Lambda_0$ be the set of those $\lambda\in\Lambda$ such that

  \ceq{\hfill {\EuScript N}}{\models}{f(t(\hat a),\,\lambda)\le0}

  or, equivalently, such that

  \ceq{\hfill {\EuScript N}}
  {\models}
  {f(\beta',\,\lambda)\le0,}
  \hfill 
  where $\beta'\in\mathds{R}^{|t|}$ is such that
  $\displaystyle\lim_{i\to F}\ t(\hat a\,i)$.

  As $\Lambda_0$ is compact, the function $g$ defined below is continuous 

  \ceq{\hfill g:\mathds{R}^{|t|}}{\to}{\mathds{R}}

  \ceq{\hfill\beta\kern1.5ex}{\mapsto}{\sup_{\lambda\in\Lambda_0} f(\beta,\lambda).}

  Given $\varepsilon>0$, let $B_\varepsilon=g^{-1}(-\infty,\varepsilon]$ and $u=\{i:{\EuScript M}_i\models g(t(\hat a i))\le\varepsilon\}$.
  As $B_\varepsilon$ is a neighborhood of $\beta'$, the set $u$ belongs to $F$ and for every $\lambda\in\Lambda_0$ and $i\in u$

  \ceq{2.\hfill u_\varepsilon}
  {\subseteq}
  {\Big\{ i\ ;\ {\EuScript M_i}\models f(t(\hat a i),\,\lambda)\le\varepsilon\Big\}}


\end{proof}
\end{document}
%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%

  \ceq{\hfill {\EuScript N}\models f(t(\hat a),\,\lambda)\le0}
  {\Leftrightarrow}
  {{\EuScript N}\models f(\beta',\,\lambda)\le0}
  \hfill 
  where $\beta'\in\mathds{R}^{|t|}$ is such that
  $\displaystyle\lim_{i\to F}\ t(\hat a\,i)$



  \vfill
  
  \ceq{\hfill g(\beta)\le\varepsilon}
  {\Leftrightarrow}
  {\beta\in B.}

  Let $\beta'\in\mathds{R}^{|t|}$ be such that

  \ceq{\hfill\lim_{i\to F}\ t(\hat a\,i)}
  {=}
  {\beta.}

  Let $\Lambda_{\le0}$ be the set of those $\lambda\in\Lambda$ such that $f(\beta,\lambda)\le0$.
  



  $t(\hat a,\lambda)\le s(\hat a,\lambda)$.
  We spell out the proof for the infimum quantifier.
  Assume inductively that

  \ceq{\hfill \varphi^{\EuScript N}\big(\hat a,\hat b\big)}
  {=}
  {\lim_{i\to F}\varphi^{\breve M_i}\big(\hat ai,\hat bi\big).}

  We want to prove that

  \ceq{\hfill\Big(\bigwedge_x\varphi\big(\hat a,x\big)\Big)^{\EuScript N}}
  {=}
  {\lim_{i\to F}\Big(\bigwedge_x\varphi\big(\hat ai,x\big)\Big)^{\breve M_i}}



  By the interpretation of the infimum quantifier, this amounts to prove that

  \ceq{\hfill\inf\big\{\varphi\big(\hat a,\hat b\big)^{\EuScript N}\ :\ \hat b\in(uN)\big\}}
  {=}
  {\lim_{i\to F}\inf\big\{\varphi\big(\hat ai,b\big)^{\breve M_i}:\,b\in(u\breve M_i)\big\}}

  First we prove the $\le$ inequality.
  Let $\alpha$ be an arbitrary positive real number.

  \ceq{\textrm{Assume\ that\ for\ some\ }\hat b\in(uN)\hfill\varphi^{\EuScript N}\big(\hat a,\hat b\big)}{<}{\alpha}.

  \ceq{\textrm{By\ induction\ hypothesis}\hfill\lim_{i\to F}\varphi^{\breve M_i}\big(\hat ai,\hat bi\big)}{<}{\alpha},

  \ceq{\textrm{then\ for\ some\ }u\in F\hfill\varphi^{U_i}\big(\hat ai,\hat bi\big)}{<}{\alpha}\quad for every $i\in u$.

  \ceq{\textrm{Hence}\hfill \inf\Big\{\varphi^{\breve M_i}\big(\hat ai,b\big):\,b\in(u\breve M_i)\Big\}}{<}{\alpha}\quad for every $i\in u$.

  \ceq{\textrm{Finally,}\hfill\lim_{i\to F}\ \inf\Big\{\varphi^{\breve M_i}\big(\hat ai,b\big):\,b\in(u\breve M_i)\Big\}}{<}{\alpha}.

  \smallskip
  This proves the $\ge$ inequality.
  As for the $\le$ inequality, assume that
  \smallskip

  \ceq{\hfill\lim_{i\to F}\inf\Big\{\varphi\big(\hat ai,b\big)^{\breve M_i}:\,b\in(u\breve M_i)^{|x|}\Big\}}
  {<}
  {\alpha.}

  Therefore, for some $u\in F$

  \ceq{\hfill\inf\Big\{\varphi\big(\hat ai,b\big)^{\breve M_i}:\,b\in(u\breve M_i)^{|x|}\Big\}}{<}{\alpha}\quad for every $i\in u$.

  \ceq{\hfill\inf\Big\{\varphi\big(\hat ai,b\big)^{\breve M_i}:\,b\in(u\breve M_i)^{|x|}\Big\}}{<}{\alpha}\quad for every $i\in u$.

  Such a neighborhood exists because $f$ is uniforml;y continuous and $\Lambda$ is 

  \ceq{\textrm{Therefore,\ for\ some\ }\hat b\in(uN)^{|x|}\hfill \varphi^{\breve M_i}\big(\hat ai,\hat bi\big)}{<}{\alpha}\quad for every $i\in u$.

  \ceq{\textrm{Then}\hfill\lim_{i\to F}\varphi^{\breve M_i}\big(\hat ai,\hat bi\big)}{<}{\alpha,}

  \ceq{\textrm{and\ finally}\hfill\vphantom{\bigwedge_x}\varphi^{\EuScript N}\big(\hat a, \hat b\big)}{<}{\alpha.}

  This proves the desired inequality.
\end{proof}

The following corollary of  \L\v{o}\'s Theorem is identical to its classical counterpart.

\begin{corollary}
  For every model ${\EuScript M}$ and every ultrafilter $F$ on $I$, an infinite set, let ${\EuScript N}$ be corresponding ultrapower of ${\EuScript M}$.
  Then there is an elementary embedding of ${\EuScript M}$ in ${\EuScript N}$.\qed
\end{corollary}

Note also that, unlike the classical ultraproduct, here we do not quotient the structure obtained in Definition~\ref{def_ultraproduct}.
However, we note the following fact which is an easy consequence of \L\v o\'s Theorem.

\begin{fact}
  Let $R\subseteq N^2$ be the set of those pairs $(\hat a, \hat b)$ such that $\{i\in I:\hat ai=\hat bi\}\in F$.
  Then $R$ is an elementary relation.\qed
\end{fact}

%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
\section{Examples}

\def\ceq#1#2#3{\parbox[t]{25ex}{$\displaystyle #1$}\parbox{5ex}{\hfil $#2$}{$\displaystyle #3$}}

\begin{itemize}
  \item [1.] Firstly, we leave to the reader to check that classical first-order models are a (trivial) special cases of the models introduced above.
        Classical relations take values in $\{0,1\}$ where $0$ is interpreted as ``true''.
        The unit ball is the whole of ${\EuScript M}$.
        The function $n_{\mbox-}$ is constantly $1$.
        To obtain the full strength of first-order logic one has to add equality as a predicate as it is absent from our logic.

  \item [2.] Secondly, any {\sc bbhu}-premodel is also a model as those in Section~\ref{uno} if we let the unit ball coincide with ${\EuScript M}$.
        The language $L$ contains a relation symbol $d(x,y)$ for a metric and, possibly, symbols for all other functions and relations of ${\EuScript M}$.
        As all relations of ${\EuScript M}$ (including the metric) take values in the interval $[0,1]$, the function $n_{\mbox-}$ can be set to be the constant $1$.

  \item [3.] Now we consider an example that is non trivial and distant both from classical models and from {\sc bbhu}-models: weighted graphs.
        The set $L_{\rm fun}$ is empty and $L_{\rm rel}$ contains only a binary relation $r$.
        We require that $r^{\EuScript M}(a,b)=r^{\EuScript M}(b,a)\in[0,1]$.
        As unit ball take, again,the whole of ${\EuScript M}$.
        The function $n_{\mbox-}$ is constant $1$.


  \item [4.] Finally, and example where the unit ball is non trivial.
        Let $L$ be the language of Banach spaces.
        Here we have only one symbol in $L_{\rm rel}$, the symbol $\|\mbox-\|$ for the norm.
        The set $L_{\rm fun}$ is the same as for real vector spaces in classical logic.
        Let ${\EuScript M}$ be a Banach space and define a continuous model as follows.
        The interpretation of the symbols in $L_{\rm rel}\cup L_{\rm fun}$ is the natural one.
        The unit ball of is $\breve M=\{a\in \breve M: \|a\|\le1\}$.
        If $\varphi(x)$ is the atomic formulas

        \ceq{\hfill\varphi(x)}{=}{\Big\|\sum_{i=1}^n\lambda_i x\,\Big\|}

        then

        \ceq{\hfill n_{\varphi(x)}}{=}{\sum_{i=1}^n|\lambda_i|.}

        % Let $\varphi(x)$ be an atomic formula.
        % This has form $\|t(x)\|$ for some $t(x)\in L_{\rm trm}$.  
        % Note that $\sup\{\|t(a)\|: a\in U^{|x|}\}$ does not depend on $\breve M$.
        % Therefore we can set it to be $n_{\varphi(x)}$

\end{itemize}

%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
\section{Conditions and types}

For $\varphi, \psi\in L(\breve M)$ some closed formulas, we write \emph{${\EuScript M}\models\ \varphi\le\psi$} for $\varphi^{\EuScript M}\le\psi^{\EuScript M}$.
The meaning of \emph{${\EuScript M}\models\ \varphi=\psi$\/} and of \emph{${\EuScript M}\,\models\ \varphi<\psi$\/} is similar.

Expressions of the form $\varphi(x)\le0$ are called \emph{conditions}.
We write ${\EuScript M}\models\exists x\,\varphi(x)\le0$ if there is an $a\in \breve M^{|x|}$ such that ${\EuScript M}\models\varphi(a)\le0$.
Observe that $\varphi(x)=0$ is equivalent to $|\varphi(x)|\le0$ and that $\varphi(x)\le0$ is equivalent to $\big(\varphi(x)\vee0\big)=0$.
So, when convenient, we may use equalities to denote conditions.

The negation of a condition is called a \emph{co-conditions}.
So, $\varphi(x)\neq0$, $\varphi(x)<0$ or $\varphi(x)>0$ are co-conditions.

It is easy to see that conditions are cosed under logical disjunction and logical conjunction.

\ceq{\hfill {\EuScript M}\models\varphi\vee\psi\le0}
{\Leftrightarrow}
{{\EuScript M}\models\varphi\le0 \textrm{ and }{\EuScript M}\models\psi\le0}

\ceq{\hfill {\EuScript M}\models\varphi\wedge\psi\le0}{\Leftrightarrow}{{\EuScript M}\models\varphi\le0 \textrm{ \ or \ }{\EuScript M}\models\psi\le0}

Condition are also closed under universal quanfication (over the unit ball).

\ceq{\hfill {\EuScript M}\models\bigvee_x\varphi(x)\le0}{\Leftrightarrow}{{\EuScript M}\models\forall x\ \varphi(x)\le0}

Closure under existential quanfication is a more subtle point.
It is not true in general but it can be ensured by a small amount of saturation (cf.~Fact~\ref{fact_existential}).

A set of conditions is called a \emph{type\/} or, when $x$ is the empty tuple, a \emph{theory.}
For $p(x)\subseteq L(\breve M)$, we define

\hfil\emph{$p(x)\le0$}\ \ =\ \ $\big\{\varphi(x)\le0 \ \  :\ \  \varphi(x)\in p\big\}.$

Up to equivalence, all types have the form above.

Beware that $p(x)$ denotes just a set of formulas, the expression $p(x)\le0$ denotes a type.

We write \emph{${\EuScript M}\models p(a)\le0$} if ${\EuScript M}\models\varphi(a)\le0$ for every $\varphi(x)\in p$.
We write \emph{${\EuScript M}\models \exists x\ p(x)\le0$} if ${\EuScript M}\models p(a)\le0$ for some $a\in \breve M^{|x|}$.

%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%
\section{Elementary relations}

\def\ceq#1#2#3{\parbox[t]{28ex}{$\displaystyle #1$}\parbox{6ex}{\hfil $#2$}{$\displaystyle #3$}}

Let ${\EuScript M}$ and ${\EuScript N}$ be models with unit balls $\breve M$ and $N$, respectively.
We say that $R\subseteq \breve M\times N$ is an \emph{elementary relation\/} between $\breve M$ and $N$ if for every $\varphi(x)\in L$

\ceq{\hfill \varphi^{\EuScript M}(a)}{\Leftrightarrow}{\varphi^{\EuScript N}(b)} \hfill for every $a,b\in \breve M^{|x|},N^{|x|}$ such that $aRb$.

Equivalently, if for every $\varphi(x)\in L$

\ceq{\hfill {\EuScript M}\models \varphi(a)\le0}{=}{{\EuScript N}\models \varphi(a)\le0} \hfill for every $a,b\in \breve M^{|x|},N^{|x|}$ such that $aRb$.

We define an equivalence relation \emph{$(\sim_{\breve M\!})$\/} on the unit ball $\breve M$ as follows

\ceq{1.\hfill a\, \sim_Mb}{\Leftrightarrow}{\varphi(a)^{\EuScript M}=\varphi^{\EuScript M}(b)}\ \ for every $\varphi(x)\in L(\breve M)$.

In ther words,

\ceq{\hfill a\, \sim_Mb}{\Leftrightarrow}{I_M\cup\{(a,b)\}\subseteq \breve M^2}\ \ is an elementary relation.

As elementary relations are closed under composition, if $a\sim_M\!b$ and $a'\sim_M\!b'$ then the relation $I_M\cup\big\{(a,b),(a',b')\big\}\subseteq \breve M^2$ is also elementary.
In general, for any $a=a_1,\dots,a_n$ and $b=b_1,\dots,b_n$ we have that

\ceq{2.\hfill a_i\, \sim_Mb_i\textrm{ for all }i}{\Leftrightarrow}{\varphi(a)^{\EuScript M}=\varphi^{\EuScript M}(b)}\ \ for every $\varphi(z)\in L(\breve M)$.

From the consideration above we deduce the following.
\begin{lemma}
  The relation $(\sim_{\breve M\!})\subseteq \breve M^2$ is a maximal elementary relation.
  That is, no elementary relation on $\breve M$ contains $(\sim_{\breve M\!})$ properly.
\end{lemma}

\begin{proof}
  By 2 above, $(\sim_{\breve M\!})$ is elementary.
  By 1, a pair $a\nsim_M\!b$ cannot belong to any elementary relation.
  Therefore  $(\sim_{\breve M\!})$ is maximal.
\end{proof}

\begin{lemma}
  Let $R\subseteq \breve M\times N$ be total and surjective elementary relation.
  Then there is a unique maximal elementary relation containing $R$.
  This maximal elementary relation is equal to both $(\sim_{\breve M\!})\,R$ and $R\,(\sim_{N\!})$.
\end{lemma}
\begin{proof}
  It is immediate to verify that $(\sim_{\breve M\!})\,R$ is an elementary relation containing $R$.
  Let $S$ be any maximal elementary relation containing $R$.
  By maximality, $(\sim_{\breve M\!})\,S=S$.
  As $S$ is a total relation $(\sim_{\breve M\!})\subseteq SS^{-1}$.
  Therefore, by the lemma above, $(\sim_{\breve M\!})=SS^{-1}$.
  As $R$ is a surjective relation, $S\subseteq S\,S^{-1}R$.
  Finally, by maximality, we conclude that $S=(\sim_{\breve M\!})\,R$.
  A similar argument proves that $S=R\,(\sim_{N\!})$.
\end{proof}

We write ${\rm Aut}({\EuScript M})$ for the set of maximal, total and surjective, elementary relations $R\subseteq \breve M^2$.
The choice of the symbol Aut is motivated by the lemma above.
In fact any such relation $R$ induces a unique automorphism on the (properly defined) quotient structure ${\EuScript M}/{\sim_M}$.

Thought in most situations one could dispense with ${\EuScript M}$ in favour of ${\EuScript M}/{\sim_M}$, in concrete cases one has a better grip on the first than on the latter.
Therefore below we insist in working with elementary relations in place of elementary maps.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Elementary substructures}

An \emph{elementary embedding\/} is an elementary relation that is functional, injective and total.

When $\varnothing$ is an elementary relation between $\breve M$ and $N$, the unit balls of ${\EuScript M}$ and ${\EuScript N}$, we say that ${\EuScript M}$ and ${\EuScript N}$ are \emph{elementarily equivalent\/} and write \emph{${\EuScript M}\equiv {\EuScript N}$.}
We write $I_A$ for the diagonal relation on a set $A$.
We write \emph{${\EuScript M}\equiv_A{\EuScript N}$\/} if $I_A$ is an elementary relation.
In words, we say that ${\EuScript M}$ and ${\EuScript N}$ are elementary equivalent \emph{over $A$.}
Finally, we write \emph{${\EuScript M}\preceq{\EuScript N}$\/} if ${\EuScript M}\equiv_M{\EuScript N}$ and ${\EuScript M}\subseteq{\EuScript N}$, that is ${\EuScript M}$ is a substructure of ${\EuScript N}$ in the classical sense.
In words, we say that ${\EuScript M}$ is an \emph{elementary substructure\/} of ${\EuScript N}$.


Let $A\subseteq \breve M$.
The \emph{limit $A$-topology\/} on $\breve M^{|x|}$ is the initial topology with respect to the functions that interpret the formulas in $L(A)$.
The sets $\big\{a\in \breve M^{|x|}:\, \varphi^{\EuScript M}(a)\le0\big\}$, as $\varphi(x)$ ranges over $L(A)$, form a base of closed sets for the limit $A$-topology.
Note that the sets $\big\{a\in \breve M^{|x|}:\, \varphi^{\EuScript M}(a)<0\big\}$ are a base of open sets of the same topology.

The limit $A$-topology is a completely regular topology, almost by definition.
Typically, it is not T$_0$, but its Kolmogorov quotient is Hausdorff.

\begin{proposition}[Tarski-Vaught test]\label{prop_Tarski-Vaught} Let ${\EuScript M}\subseteq{\EuScript M}$.
  Let $x$ be a single variable.
  Then the following are equivalent
  \begin{itemize}
    \item[1.] ${\EuScript M}\preceq{\EuScript N}$;
    \item[2.] $\breve M$ is dense in $N$ w.r.t.\@ the $\breve M\mbox{-}$limit topology on $N$;
    \item[3.] for every $\varphi(x)\in L(\breve M)$, if $\varphi(N)<0$ is non empty, then ${\EuScript N}\models\varphi(b)<0$ for some $b\in \breve M$.
  \end{itemize}
\end{proposition}
\begin{proof}
  Equivalence 2$\Leftrightarrow$3 is tautological.
  Implication 1$\Rightarrow$2 is clear.
  To prove 3$\Rightarrow$1 we prove by induction on the syntax of $\varphi(z)$, where $z$ is a finite tuple, that for every $\alpha\in{\mathds R}$

  \ceq{\hfill {\EuScript M}\models\varphi(a)<\alpha}{\Leftrightarrow}{{\EuScript N}\models\varphi(a)<\alpha} \hfill for every $a\in \breve M^{|z|}$

  We use the equivalence above as induction hypothesis.
  As $\breve M$ is a substructure of $N$, this equivalence holds for atomic $\varphi(z)$.
  We leave the case of the propositional connectives to the reader and consider only the case of the infimum quantifier.

  \ceq{\hfill N\,\models\,\smash{\bigwedge_x}\varphi(x,a)<\alpha}{\Leftrightarrow}{} there is a $b\in N$ such that ${\EuScript N}\models\varphi(b,a)<\alpha$

  \ceq{a.}{\Leftrightarrow}{} there is a $b\in \breve M^{|x|}$ such that ${\EuScript N}\models\varphi(b,a)<\alpha$

  \ceq{b.}{\Leftrightarrow}{\breve M\,\models\,\bigwedge_x\varphi(x)<\alpha.}

  Implication $\Rightarrow$ in \textit{a} uses the assumption 3 and the equivalence in \textit{b} uses the induction hypothesis.
\end{proof}

% \begin{remark}
% In the Tarski-Vaught test for classical logic it is not necessary to require that $\breve M$ is a substructure of $N$ as this is a consequence of the test.
% In the continuous case this is necessary by the lack of a predicate for equality.\qed
%Still, we may drop this assumption when $\breve M$ is metric complete. In fact, we can apply 2 as follows. For every function symbol $f$ and every $a\in \breve M^{<\omega}$ the formula $d(fa,x)<\varepsilon$ has a witness in $\breve M$ for all $\varepsilon\in{\mathds R}^+$. Hence $f{a}\in \breve M$ follows from completeness.
% \end{remark}

\begin{theorem}[Downward L\"owenheim-Skolem] For every $A\subseteq N$ there is a model $A\subseteq \breve M\preceq N$ of cardinality $\le |L(A)|$.
\end{theorem}
\begin{proof} (Needs some checking.)
  For every set $A$ there is a base for the $A\mbox{-}$topology that has cardinality $\le |L(A)|$. A set $\breve M$ of the required cardinality that is dense in the  $\breve M\mbox{-}$topology is obtained as in the classical downward L\"owenheim-Skolem theorem.
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Saturation}\label{saturation}

\def\ceq#1#2#3{\parbox[t]{20ex}{$\displaystyle #1$}\parbox{5ex}{\hfil $#2$}{$\displaystyle #3$}}

From this section on, we assume the existence of unboundedly many inaccessible cardinals as this simplifies the exposition.
We prove directly the existence of saturated extension (monster models), skipping the proof of the compactness theorem as this is not required in the following.
(The compactness theorem could be proved along the same lines.)

Let $p(x)\subseteq L(\breve M)$.
We say that $p(x)\le 0$ is \emph{finitely satisfied in ${\EuScript M}$\/} if for every disjunction of formulas in $p(x)$, say $\psi(x)$, there is an $a\in \breve M^{|x|}$ such that ${\EuScript M}\models\psi(a)\le0$.

\begin{definition}
  We say that ${\EuScript M}$ is \emph{saturated\/} if for every $p(x)$ as in 1 and 2 below, there is an $a\in \breve M^{|x|}$ such that ${\EuScript M}\models p(a)\le0$
  \begin{itemize}
    \item[1.] $p(x)\subseteq L(A)$ for some $A\subseteq \breve M$ of cardinality $<|\breve M|$ and $|x|=1$;
    \item[2.] $p(x)\le0$ is finitely satisfied in $\breve M$.
  \end{itemize}
\end{definition}

From \L\v{o}\'s Theorem we obtain that every model embeds elementarily in a saturated one.
First we prove the following lemma.

\begin{lemma}\label{thm_compattezza}
  Every model ${\EuScript M}$ embeds elementarily in a model ${\EuScript N}$ that realizes all types as in 1 and 2.
\end{lemma}

\begin{proof}
  Consider the collection of types such that 1 and 2 above.
  Assume that each type has its own set of variables and let $x$ be the concatenation of all these variables.
  We denote by $p(x)$ the union of all these types.
  Let $I$ be the set of formulas $\xi(x)$ such that $\xi(x)\le0$ is satisfied in $\breve M$.
  For every condition $\varphi(x)\le0$ define $X_\varphi\subseteq I$ as follows

  \ceq{\hfill X_\varphi}{=}{\Big\{\xi(x)\in I\ :\ \xi(\breve M)\le0\ \subseteq\ \varphi(\breve M)\le0\Big\}}

  Note that $\varphi(x)\le0$ is consistent if and only if $X_\varphi\neq\varnothing$ if and only if $\varphi(x)\in X_{\varphi}$.
  Moreover $X_{\varphi\vee\psi}\ =\ X_\varphi\cap X_\psi$. Then, as $p(x)$  is finitely consistent, the set $B=\big\{X_\varphi\,:\,\varphi(x)\in p\big\}$ has the finite intersection property.
  Extend $B$ to an ultrafilter $F$ on $I$.
  Let ${\EuScript N}$ be the ultrapower of ${\EuScript M}$ over $F$.
  That is the model with unit ball $N=\breve M^I$ obtained as in Definition~\ref{def_ultraproduct}.

  For every formula $\xi(x)\in I$ choose some $a_\xi\in \breve M^{|x|}$ such that $\xi(a_\xi)\le0$.
  We may confuse $(\breve M^I)^{|x|}$ with $(\breve M^{|x|})^I$ as it simplifies notation.
  Let $\hat a\in (\breve M^{|x|})^I$ be the function that maps $\xi(x)\mapsto a_\xi$.
  By \L\v o\'s Theorem, for every formula $\varphi(x)$

  \ceq{\hfill \varphi^{\EuScript N}\big(\hat a\big)}{=}{\lim_{\xi\to F}\varphi^{\breve M}\big(a_\xi\big).}

  Therefore $\hat a$ realizes $p(x)\le0$ in ${\EuScript N}$.
\end{proof}

\begin{theorem}
  Every model ${\EuScript M}$ embeds elementarily in a saturated model.
\end{theorem}

\begin{proof}
  As usual, iterate the lemma to construct a chain of length $\lambda$, a sufficiently large inaccessible cardinal.
\end{proof}

We conclude with a convenient property of saturated models.

\begin{fact}\label{fact_existential}
  Let $\breve M$ is saturated.
  Then for every $\varphi(x)\in L(\breve M)$ the following are equivalent
  \begin{itemize}
    \item[1.] $\breve M\models\exists x\ \big(\varphi(x)\le0\big)$;
    \item[2.] \smash{$\breve M\models\displaystyle \bigwedge_x \varphi(x)\;\le\;0$}
  \end{itemize}
\end{fact}
\begin{proof}
  Only 2$\Rightarrow$1 requires a proof.
  Let $p(x)=\{\varphi(x)-\alpha: \alpha\in{\mathds R}^+\}$.
  If 2, then $p(x)\le0$ is finitely satisfied in $\breve M$.
  Hence 1 follows by saturation.
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Homogeneity}

Throughout the following we fix a saturated model \emph{$\EuScript U$\/} of cardinality $\kappa$, an inaccessible cardinal larger than $|L|$, where $|L|$ stands for $\max\big\{|L_{\rm fun}|,|L_{\rm rel}|,2^\omega\big\}$.

Let $a\in{\EuScript U}^{|x|}$.
We write $p(x)={\rm tp}(a/A)$ for $p(x)=\big\{\psi(x)\in L(A):{\EuScript U}\models \psi(a)\le0\big\}$.
We write ${\rm tp}(a)$ when $A=\varnothing$.

\begin{fact}
  Let $R\subseteq{\EuScript U}^2$ be an elementary relation of cardinality $<\kappa$.
  Then there is a total and surjective elementary relation $S\subseteq{\EuScript U}^2$ containing $R$.
\end{fact}

\begin{proof}
  We apply the usual back-and-forth construction with a pinch of extra caution.
  Below we will make free use of Fact~\ref{fact_existential}.
  Let $a$ be an enumeration of the domain of $R$.
  Let $\bar a=\langle a_i:i<\lambda\rangle$ be an enumeration of all tuples of length $|a|$ such that $aRa_i$.
  As $\kappa$ is inaccessible, $\lambda<\kappa$.
  Let $b\in{\EuScript U}$.
  It suffices to prove that there is a $c$ such that $R\cup\{\langle b,c\rangle\}$ is an elementary relation.
  Let $p(x,z)={\rm tp}(b,a/A)$ and let
  
  \ceq{\hfill q(x,\bar z)}{=}{\bigcup_{i<\lambda}p(x,z_i).}

  We claim that $q(x,\bar a)\le0$ is finitely consistent.
  A finite conjunction of formulas in $q(x,\bar a)$ has the form $\psi(x,a_{i_1})\wedge\dots\wedge\psi(x,a_{i_n})$.
  As $\psi(b,a)\le0$ and $a_{i_1},\dots,a_{i_n}\,R\;a,\dots,a$, we conclude that the condition $\psi(x,a_{i_1})\wedge\dots\wedge\psi(x,a_{i_n})\le0$ is satisfied.
  The existence of the required element $c$ follows from saturation.
\end{proof}

\begin{corollary}
  Let $a\in{\EuScript U}^{|x|}$, where $|x|<\kappa$.
  Let $A\subseteq{\EuScript U}$ have cardinality $<\kappa$.
  Then

  \ceq{\hfill p({\EuScript U})\le0}{=}{\big\{b : bRa,\ R\in{\rm Aut}({\EuScript U}/A)\big\}}
\end{corollary}


\hrulefill

Di qui in poi solo esperimenti selvaggi.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Random variables}

Let ${\EuScript A}$ be a $\sigma$-algebra of subsets of $\Omega$.
Let ${\EuScript M}$ be the set of bounded $\sigma$-additive measures on ${\EuScript A}$.
Let ${\EuScript R}$ be the set of functions $f:\Omega\to{\mathds R}$ that are measurable w.r.t.\@ all measures in ${\EuScript M}$.

We define a $3$-sorted structure $\langle{\EuScript A},{}^{\circ\!}{\EuScript R},{}^{\circ\!}{\EuScript M}\rangle$.

The domain of the first sort is ${\EuScript A}$.
The language contains functions for the Boolean operations.

% On $\Omega$ we define the equivalence relation $\sim_{\EuScript A}$ as follows: $a\sim_{\EuScript A} b$ if $a\in A\leftrightarrow b\in A$ for every $A\in{\EuScript A}$.
% We make use of $\Omega$ and  $\sim_{\EuScript A}$ in the definitions of $\langle{\EuScript A},{}^{\circ\!}{\EuScript R},{}^{\circ\!}{\EuScript M}\rangle$ but they will not directly appear in the structure.

% We now define ${}^{\circ\!}{\EuScript R}$ and ${}^{\circ\!}{\EuScript M}$.
% We warn the reader that, at a deeper level these two domain contains the same elements, the difference being only in the syntax.

The domain of the second sort ${}^{\circ\!}{\EuScript R}$ contains the functions $f\in{\mathds R}$ that are linear combinations of indicator functions of sets in ${\EuScript A}$.
In the language we include the functions that make ${}^{\circ\!}{\EuScript R}$ an ${\mathds R}$-algebra (sum and and multiplications are defined pointwise).
We also include operations for the pointwise maximum and minimum of two functions.
% The unit ball, $S$, contains functions that are $\le1$ in absolute value.

The domain of the third sort, ${}^{\circ\!}{\EuScript M}$, contains signed measures $\mu:{\EuScript A}\to{\mathds R}$ that are linear combinations of measures of the form $\delta_a$, for $a\in\Omega$.
These are defined as follows: $\delta_a(A)$ is $1$ if $a\in A$ and $0$ otherwise.
The language is that of lattice vector spaces.
% The unit ball, $\breve M$, contains the measures in ${}^{\circ\!}{\EuScript M}$ that are $\le1$ in absolute value.

There is a function of sort ${}^{\circ\!}{\EuScript R}\times{}^{\circ\!}{\EuScript M}\to{}^{\circ\!}{\EuScript M}$ that maps $(f,\mu)$ to the measure $f\mu$ obtained multiplying in the natural way $f$ and $\mu$.

Finally, there is a predicate $I$ of sort ${\EuScript A}\times{}^{\circ\!}{\EuScript M}$ such that $I(A,\mu)=\mu(A)$.

The unit ball of $\langle{\EuScript A},{}^{\circ\!}{\EuScript R},{}^{\circ\!}{\EuScript M}\rangle$ is $\langle{\EuScript A},{}^{\circ\!\!}R,\breve M\rangle$ where ${}^{\circ\!\!}R$ and ${}^{\circ\!\!}\breve M$ are the set of functions, respectively measures, that are $\le1$ in absolute value.

The readers can easily convince themselfs that a bounding function exist.
Its explicit definition is not required in the sequel.

\hfil ***

The following discrete version of the Radon-Nikodym theorem is completely trivial.
For simplicity we state it for (nonnegative) measures.
As the Hahn decomposition theorem holds (trivially) in ${}^{\circ\!}{\EuScript M}$, this is no loss of generality.

\begin{fact}\label{thm_fRN}
  [Discrete Radon-Nikodym]
  Let $\mu,\nu\in{}^{\circ\!\!}\breve M$, where ${}^{\circ\!\!}\breve M$ is the unit ball of ${}^{\circ\!}{\EuScript M}$, be non negative.
  For every $\varepsilon > 0$ there are $E\in{\EuScript A}$ and $f\in {}^{\circ\!\!}R$, where ${}^{\circ\!\!}R$ is the unit ball of ${}^{\circ\!}{\EuScript R}$, such that
  \begin{itemize}
    \item[1.] $I(E,|\nu-\varepsilon^{-1}f\mu|)\ =\ 0$
    \item[2.] $|I(\neg E, \mu)|\le\varepsilon$.
  \end{itemize}
\end{fact}

We will use the following version of the fact above.

% \begin{fact}\label{thm_fRN2}
%   [Iterated discrete Radon-Nikodym]
%   Let $\mu,\nu\in{}^{\circ\!\!}\breve M$, where ${}^{\circ\!\!}\breve M$ is the unit ball of ${}^{\circ\!}{\EuScript M}$.
%   For every $n>0$ there are $E_1,\dots,E_n\in{\EuScript A}$ and $f\in{}^{\circ\!\!}R$, such that
%   \begin{itemize}
%     \item[0.] $E_n\subseteq E_{n-1}\subseteq {\dots\dots} \subseteq E_1\subseteq E_0=\Omega$
%     \item[1.] $I\big(E_i\smallsetminus E_{i+1},\ |\nu-2^{-(i+1)}f\mu|\big)\ =\ 0$
%     \item[2.] $|I(E_{i+1},\ \mu)|\le2^{-(i+1)}$;
%     \item[3.] $f_{i+1}\big[E_i\smallsetminus E_{i+1}\big]=\{0\}$.
%   \end{itemize}
% \end{fact}

% \begin{proof}
%   Apply inductively the theorem above, with $E_i$ for $\Omega$, to find $E_{i+1}$ and $f_{i+1}$ such that
%   \begin{itemize}
%     \item[1$_i$.] $I\big(E_i\smallsetminus E_{i+1},\ |\nu-2^{-(i+1)}f_{i+1}\mu|\big)\ =\ 0$;
%     \item[2$_i$.] $|I(E_{i+1},\ \mu)|\le2^{-(i+1)}$;
%     \item[3$_i$.] $f_{i+1}\big[E_i\smallsetminus E_{i+1}\big]=\{0\}$.
%   \end{itemize}
%   Finally, let $f=f_1+\dots+f_n$.
% \end{proof}


\begin{fact}\label{thm_fRN2}
  [Iterated discrete Radon-Nikodym]
  Let $\mu,\nu\in{}^{\circ\!\!}\breve M$ be non negative.
  For every $n>0$ there are $E_1,\dots,E_n\in{\EuScript A}$ and $f\in{}^{\circ\!\!}R$ such that
  \begin{itemize}
    \item[0.] the $E_i$ are pairwise disjoint;
    \item[1.] $I\big(E_i,\ |\nu-2^if\mu|\big)\ =\ 0$
    \item[2.] $|I(X,\ \mu)|\le2^{-i}$, where $X=\neg(E_1\cup\dots\cup E_i)$;
  \end{itemize}
\end{fact}


\begin{proof}
  Apply inductively the theorem above, with $E_i$ for $\Omega$, to find $E_{i+1}$ and $f_{i+1}$ such that
  \begin{itemize}
    \item[1$_i$.] $I\big(E_i,\ |\nu-2^if_i\mu|\big)\ =\ 0$;
    \item[2$_i$.] $|I(X,\ \mu)|\le2^{-i}$, where $X=\neg(E_1\cup\dots\cup E_i)$;
    \item[3$_i$.] $f_i\big[\neg E_i]=\{0\}$.
  \end{itemize}
  Finally, let $f=f_1+\dots+f_n$.
  The third condition above (which is immediate to obtain) ensures that $f\in{}^{\circ\!\!}R$.
\end{proof}

% Write $\nu\ll\mu$ if for every $\varepsilon>0$ there is a $\delta>0$ such that $I(X,\mu)\le\delta\Rightarrow I(X,\nu)\le\varepsilon$ for all $X\in$.


% \begin{corollary}\label{cor_fRN}
%   Let $\mu,\nu\in{}^{\circ\!\!}\breve M$ be such that $\nu\ll\mu$.
%   For every $\varepsilon > 0$ there exist an exceptional set $E\in{\EuScript A}$ and an $f\in S$, the unit ball of ${}^{\circ\!}{\EuScript R}$, such that
%   \begin{itemize}
%     \item[1.] $I(X,1,\nu)\ =\ I(X,f/\varepsilon,\mu)$ for evey $X\subseteq\neg E$;
%     \item[2.] $\displaystyle\sup_{X\subseteq E}|I(X, \mu)|\le\varepsilon$.
%   \end{itemize}
% \end{corollary}

% We note that 1 \& 2 of Theorem~\ref{thm_fRN} can be expressed by a condition.
% Infact, if $\varphi(X)$ is a formula, where $X$ is a variable of sort ${\EuScript A}$, then $\sup_{Y\subseteq X}\varphi(Y)$ is a formula --~as it is equivalent to $\sup_Y\varphi(Y\cap X)$.
% Also, recall that conditions are closed under the Boolean operations of conjunction and disjunction.
% They are also closed under universal quantification.

We now consider a saturated extension of $\langle{\EuScript A},{}^{\circ\!}{\EuScript R},{}^{\circ\!}{\EuScript M}\rangle$ that we denote by $\langle{}^{*\!\!\!}{\EuScript A},{}^{*\!}{\EuScript R},{}^{*\!}{\EuScript M}\rangle$.
The following fact is a direct consequence of saturation.

\begin{fact}
  Let $\mu\in{\EuScript M}$.
  Then there is ${}^{*\!\!}\mu\in{}^{*\!}{\EuScript M}$ such that $\mu_{\restriction{\EuScript A}}={}^{*\!\!}\mu_{\restriction{\EuScript A}}$.
\end{fact}

\begin{proof}
  It suffices to check that the following type is finitely consistent in ${\EuScript A}$ (read $\nu$ as a variable and $\mu(X)$ as a real number)
  $$
  \big\{\nu(X)=\mu(X) \ :\ X\in{\EuScript A}\big\},
  $$
  which immediate.
\end{proof}

We can improve on the fact above.
In fact, we can also control the value of ${}^{*\!\!}\mu(A)$ for any $A\in{\EuScript A}$.

\def\ceq#1#2#3{\parbox[t]{25ex}{$\displaystyle #1$}\parbox{5ex}{\hfil $#2$}{$\displaystyle #3$}}

\begin{fact}
  Let $\mu$ be a bounded measure on ${\EuScript A}$, not necessarily in ${}^{\circ\!}{\EuScript M}$.
  Let $A\in{}^{*\!\!\!}{\EuScript A}$.
  Define 
  
  \ceq{\hfill m_{\rm in\,}}{=}{\sup\{\mu(X): X\in{\EuScript A},\ X\subseteq A\}}

  \ceq{\hfill m_{\rm ex}}{=}{\,\inf\{\mu(X): X\in{\EuScript A}, \  A\subseteq X \}}

  Then for every $m_{\rm in\,}\le r\le m_{\rm ex}$ there is a measure ${}^{*\!\!}\mu\in{}^{*\!}{\EuScript M}$ such that ${}^{*\!\!}\mu_{\restriction{\EuScript A}}=\mu_{\restriction{\EuScript A}}$ and  ${}^{*\!\!}\mu(A)=r$.
\end{fact}

\begin{proof}[Proof (sketch)]
Assume for simplicity that $\mu$ is bounded by $1$.
It suffices to check that the following type is finitely consistent (read $\nu$ as a variable and $\mu(X)$ as a real number).
$$
\big\{\nu(X)=\mu(X) \ :\ X\in{\EuScript A}\big\}
\ \ \cup\ \ \
\big\{\nu(A)=r\big\}.
$$
In fact, any ${}^{*\!\!}\mu$ realizing this type is as required by the lemma.

Let ${\EuScript A}'\subseteq{\EuScript A}$ be a finite Boolean algebra.
We define a measure $\nu$ on the Boolean algebra generated by $A,X_1,\dots,X_n$ that satisfies the type above restrected to ${\EuScript A}'\cup\{A\}$.
Let $X_1,\dots,X_n$ be the atoms of ${\EuScript A}'$.
Assume $A\notin{\EuScript A}$, to avoid trivialities.
Then there are some sets $X_i$ such that both $X_i\cap A$ and $X_i\smallsetminus A$ are nonempty.
Suppose these sets are $X_1,\dots,X_m$.
For $i\le m$ we define $\nu(X_i\cap A)=\varepsilon\,\mu(X)$ and $\nu(X_i\smallsetminus A)=(1-\varepsilon)\mu(X_i)$, where $0\le\varepsilon\le1$ is specified below.
For $i>m$ let $\nu(X_i)=\mu(X_i)$.
Note that $\mu(X_1\cup\dots\cup X_m)\ge m_{\rm ex}-m_{\rm in}$.
Therefore with a suitable $\varepsilon$, we can obtain $\nu(A)=r$.
\end{proof}

If ${\EuScript A}$ is a $\sigma$-algebra and $\mu$ is a $\sigma$-additive measure then the supremum and the infimum in the fact above are attained.
We will use the following.

\begin{corollary}
  Let $\mu\in{\EuScript M}$.
  Then for every $A\in{}^{*\!\!\!}{\EuScript A}$ there are $A_{\rm in},A_{\rm ex}\in{\EuScript A}$ such that $A_{\rm in}\subseteq A\subseteq A_{\rm ex}$ and a measures ${}^{*\!\!}\mu$ such that 
  ${}^{*\!\!}\mu_{\restriction{\EuScript A}}=\mu_{\restriction{\EuScript A}}$ and ${}^{*\!\!}\mu(A)=\mu(A_{\rm ex})$.  
  A similar claim holds for $A_{\rm in}$.
  %We can also require it holds simultaneously for any family of sets $\{A_i:i<\lambda\}\subseteq{}^{*\!\!\!}{\EuScript A}$ of small cardinality (???).
\end{corollary}
\end{document}

\begin{question}
  Let $\mu\in{\EuScript M}$.
  Let ${}^{*\!\!}\mu\in{}^{*\!}{\EuScript M}$ be as above.
  Let $f\in{}^{*\!\!}R$, the unit ball of ${}^{*\!}{\EuScript R}$, be given and assume $f$ is non negative.
  We define the function ${}^{\mu\!\!}f:\Omega\to{\mathds R}$ as follows (tentative)
  $$
  {}^{\mu\!\!}f(a)\ =\ \inf\big\{\alpha : I(A, f\,{}^{*\!\!}\mu)\le \alpha \mu(A) \ :\ A\in{\EuScript A},\ a\in A\big\}
  $$
  Is it true that for every $A\in{\EuScript A}$ 
  $$
  \int_A{}^{\mu\!\!}f{\rm d}\mu\ =\ I(A,f\,{}^{*\!\!}\mu)\ \ ?
  $$
\end{question}

\begin{theorem}[Radon-Nikodym] 
  Let $\nu,\mu\in{\EuScript M}$ be such that $\nu\ll\mu$.
  Then there is an $f\in{\EuScript R}$ such that 
  $$
  \int_X f{\rm d}\mu = \int_X {\rm d}\nu
  $$
  for every $X\in{\EuScript A}$.
\end{theorem}

\begin{proof}
  ???????????????????
\end{proof}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \section{Completeness vs.\@ saturation\quad !` please expand !}

% The $A$-limit uniformity on $\breve M^{|x|}$ is the uniformity that has the following entourages 

% \ceq{\hfill V_{\varphi(x),\, \varepsilon}}{=}{\Big\{(a,b)\in \breve M^{|x|}\times \breve M^{|x|}\quad :\quad \big|\varphi^{\EuScript M}(a)-\varphi^{\EuScript M}(b)\big|<\varepsilon\Big\}}

% for $\varphi(x)\in L(A)$ and $\varepsilon\in{\mathds R}^+$. It is the coarsest uniformity that makes all formulas in $L(A)$ uniformly continuous.

% Let $p(x)\subseteq L(\breve M)$ be a type.
% We say that $p(x)\le0$ is \emph{Cauchy\/} (in the $A$-limit uniformity) if for every $\varphi(x)\in L(A)$ and every $\varepsilon\in{\mathds R}^+$ there is a disjunction of formulas in $p(x)$, say $\psi(x)$, such that $\varnothing\neq\big(\psi(\breve M)\le0\big)^2\subseteq V_{\varphi(x),\, \varepsilon}$.

% \begin{fact}
%   Let $\lambda=L(A)$.
%   If ${}^{\circ\!\!}\breve M$ is $\lambda$-saturated then and $p(x)\subseteq L(\breve M)$ is Cauchy, then $p(x)$ is realized in ${}^{\circ\!\!}\breve M$.
% \end{fact}


% For every $\varphi(x)\in\ L(A)$ and $n\in{\mathds N}$ let 


% Suppose ${\EuScript N}\models p(a)\le0$ and let $\big(\psi(\breve M)\le0\big)^2\subseteq V_{\varphi(x),\, \varepsilon}$


\end{document}
