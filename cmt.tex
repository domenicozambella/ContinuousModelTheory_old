\documentclass[12pt,letterpaper,oneside,reqno]{amsart}


\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{comment}
\usepackage{tikz}
\usepackage{xcolor}
\usepackage{datetime2} 
\usepackage{hyperref}

\usepackage[margin=1in]{geometry}
\usepackage{mathtools}
\usepackage{enumitem}
\usepackage{calc}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage[mathcal]{euscript}
%\usepackage{bbm}
%\usepackage{latexsym}
\usepackage{mathrsfs}
%\usepackage{stmaryrd}
\usepackage{stix}
\usepackage{dsfont}

\parindent0ex
\parskip1.2ex

\newcommand{\mylabel}[1]{{#1}\hfill}
\renewenvironment{itemize}
  {\begin{list}{$\triangleright$}{%
   \setlength{\parskip}{0mm}
   \setlength{\topsep}{.2\baselineskip}
   \setlength{\rightmargin}{0mm}
   \setlength{\listparindent}{0mm}
   \setlength{\itemindent}{0mm}
   \setlength{\labelwidth}{3ex}
   \setlength{\itemsep}{.2\baselineskip}
   \setlength{\parsep}{.2\baselineskip}
   \setlength{\partopsep}{0mm}
   \setlength{\labelsep}{1ex}
   \setlength{\leftmargin}{\labelwidth+\labelsep}
   \let\makelabel\mylabel}}{%
   \end{list}}

\newtheoremstyle{plain}% 〈name〉
{\parskip}% 〈Space above〉1
{\parskip}% 〈Space below 〉1
{\color{brown!=20!red!40!black}}% 〈Body font〉
{}% 〈Indent amount〉2
{\bfseries}% 〈Theorem head font〉
{.}% 〈Punctuation after theorem head 〉
{.5em}% 〈Space after theorem head 〉3
{\llap{\thmnumber{#2}\hskip2mm}\thmname{#1}\thmnote{\kern1ex\bfseries(#3)}}% 〈Theorem head spec (can be left empty, meaning ‘normal’ )
\theoremstyle{plain}
\newtheorem{theorem}{Theorem}%[section]
\newtheorem{specialtheorem}{Theorem}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{fact}[theorem]{Fact}
\newtheorem{corollary}[theorem]{Corollary}


\newtheorem{definition}[theorem]{Definition}
\newtheorem{definitions}[theorem]{Definitions}
\newtheorem{example}[theorem]{Example}
\newtheorem{examples}[theorem]{Examples}
\newtheorem{convention}[theorem]{Convention}
\newtheorem{conventions}[theorem]{Conventions}
\newtheorem{notation}[theorem]{Notation}

\newtheorem{remark}[theorem]{Remark}
\newtheorem{remarks}[theorem]{Remarks}

\theoremstyle{remark}
\newtheorem*{claim}{Claim}

\renewcommand*{\emph}[1]{%
   \smash{\tikz[baseline]\node[rectangle, fill=olive!25, rounded corners, inner xsep=0.5ex, inner ysep=0.2ex, anchor=base, minimum height = 2.7ex]{#1};}}

\linespread{1.15}
\begin{document}
\title{Continuous model theory without the hassle}
\hfill\texttt{Branch:~el\_rel \ \DTMnow}\bigskip
\maketitle
\raggedbottom
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Formulas and their interpretation}\label{uno}

The following definition extends that of classical first-order logic with clauses 3 and 4.

\begin{definition}\label{signature}
A \emph{signature\/} or \emph{language\/} $L$ consists of\nobreak
\begin{itemize}
\item[1.] two sets of symbols: \emph{$L_{\rm rel}$\/}, for relations, and \emph{$L_{\rm fun}$}, for functions;
\item[2.] an \emph{arity\/} function \emph{\textrm{ Ar}\/} $:\ L_{\rm rel}\cup L_{\rm fun}\ \to\ \omega$;
\item[3.] a function $n_{\mbox-}:L_{\rm at}\to\mathds N$;
\item[4.] a distinguished unary relation symbol $u$.
\end{itemize}
\end{definition}

The function in 3 above is called the \emph{bounding function.}
The meaning of $L_{\rm at}$ clarified below.

\begin{definition}A \emph{structure\/} or \emph{model\/} $M$ of signature $L$ consists of the following data\nobreak
\begin{itemize}
\item[1.] for every  $f\in L_{\rm fun}$, a function $f^M:\ M^{{\rm Ar}(f)}\to M$;
\item[2.] for every $r\in L_{\rm rel}$, a function $r^M:\ M^{{\rm Ar}(r)}\to{\mathds R}$;
\item[3.] a function $u^M:M\to\{0,1\}$.   
\end{itemize}
\end{definition}

We write $uM$ for the set $\{a\in M: u^Ma=0\}$.
We call this the \emph{unit ball\/} of $M$.
It will not play any role till Definition~\hyperref[def_semantic]{\ref*{def_semantic}.vi}.
The unit ball is required to saisfy two axioms which are postponed till Definition~\ref{def_unitball}.
These axioms also clarify the role of the bounding function.

The syntax and semantic of \emph{terms} is defined just as in classical first-order logic.
We write \emph{$L_{\rm trm}$\/} for the set of terms in the language $L$.
Atomic formulas are defined as in classical first-order logic.
They have the form $r\,t$, where $r$ is a relation symbol and $t$ is a tuple of terms.
The set of atomic formulas is denoted by \emph{$L_{\rm at}$.}
The set of all formulas is denoted as usual by \emph{L,} the same symbol as the language.
Formulas are defined inductively from the atomic one using the following connectives.

The \emph{propositional\/}  (or \emph{Riesz\/}) connectives are those in $\big\{1,+,\wedge\big\}\cup{\mathds R}$, where $+$ and $\wedge$ are binary connectives, the elements of ${\mathds R}$ are unary connectives, $1$ is a logical constant (i.e.\@ a zero-ary connective).
There is also the infimum \emph{quantifier\/} $\displaystyle\bigwedge_x$.

\begin{definition}\label{def_formulas}
The inductive definition of formula is as follows

\begin{minipage}[t]{.4\textwidth}
\begin{itemize}
\item[i.] atomic formulas are formulas
\item[ii.] $1$ is a formula;
\item[iii.] $\varphi+\psi$ is a formula; 
\end{itemize}
\end{minipage}
\hfill
\begin{minipage}[t]{.4\textwidth}
\begin{itemize}
\item[iv.] $\varphi\wedge\psi$ is a formula;
\item[v.] $\alpha\varphi$ is a formula for every $\alpha\in{\mathds R}$;
\item[vi.] \smash{$\displaystyle\bigwedge_x\varphi$} is a formula.
\end{itemize}
\end{minipage}
\end{definition}

If $\alpha\in{\mathds R}$, we may write \emph{$\alpha$\/} for the formula $\alpha1$.
We write \emph{${}-\varphi$\/} for $(-1)\varphi$ and \emph{$\varphi-\psi$\/} for $\varphi+(-\psi)$ and we write \emph{$\varphi\vee\psi$\/} for ${}-(-\varphi\wedge-\psi)$.
Also, \emph{$\varphi^+$\/} and \emph{$\varphi^-$\/} stand for $0\vee\varphi$ respectively $0\vee(-\varphi)$, and we write \emph{$|\varphi|$\/} for $\varphi\vee(-\varphi)$.
Finally, \smash{\emph{$\displaystyle\bigvee_x\varphi$\/}} 
stands for $\displaystyle -\bigwedge_x-\varphi$.

If $A\subseteq M$, we write $L(A)$ for the language $L$ expanded with a $0$-ary function symbol for every element of $a$.
As in classical first-order logic, $M$ is canonically expanded to a structure of signature $L(A)$ by setting $a^M=a$ for every $a\in A$.

Let $M$ be a model and let $t$ be a tuple of closed terms possibly with parameters from $M$.
We write $t^M$ for the element obtained interpreting function symbols and parameters in $M$ just as in classical first-order logic.

\begin{definition}\label{def_semantic}
  If $\varphi\in L(M)$ is a sentence (i.e.\@ a closed formula) we define $\varphi^M$ inductively as follows
  
  \begin{minipage}[t]{.4\textwidth}
  \begin{itemize}
  \item[i.] $(r\,t)^M\ =\  r^M\big(t^M\big)$.
  \item[ii.] $1^M\ =\ 1$;
  \item[iii.] $(\psi+\xi)^M\ =\ \psi^M+\xi^M$;
  \end{itemize}
  \end{minipage}
  \begin{minipage}[t]{.59\textwidth}
  \begin{itemize}
  \item[iv.] $(\alpha\varphi)^M\ =\ \alpha\varphi^M$;
  \item[v.] $(\psi\wedge\xi)^M\ =\ \min\big\{\psi^M,\ \xi^M\big\}$; 
  \item[vi.]  \noindent\smash{$\displaystyle\big(\bigwedge_x\psi\big)^M\ =\ \inf\big\{\psi[x/b]^M :\  b\in (uM)\big\}$}.
  \end{itemize}
  \end{minipage}
  \end{definition}
  \medskip

In Fact~\ref{fact_finiteness} below we prove that the infimum in (vi) above is indeed finite, hence that the definition is sound.

For $\varphi(x)\in L(M)$ we write $\varphi^M$ for the function $\varphi^M:M^{|x|}\to{\mathds R}$ that maps $a\mapsto\varphi(a)^M$.

Finally, we complete the definition of structure by giving the axiomatics of the unit ball and of the bounding function.

\begin{definition}\label{def_unitball}
  The unit ball is required to satisfy the following axioms 
  \begin{itemize}
  \item[1.] $M=\big\{t^M:\ t\in L_{\rm trm}(uM) \textrm{ a closed term }\big\}$;
  \item[2.] $|\varphi(a)^M|\le n_{\varphi(x)}$ for every $a\in (uM)^{|x|}$ and every $\varphi(x)\in L_{\rm at}$.
  \end{itemize}
\end{definition}

A straightforeward proof by induction on the syntax yields the following.

\begin{fact}\label{fact_finiteness}
  For every formula $\psi(x)$ there is an $n\in{\mathds N}$ such that $|\psi(a)^M|\le n$ for all $a\in(uM)^{|x|}$.\qed
\end{fact}


%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
\section{Examples}

\def\ceq#1#2#3{\parbox[t]{25ex}{$\displaystyle #1$}\parbox{5ex}{\hfil $#2$}{$\displaystyle #3$}}

\begin{itemize}
  \item [1.] Firstly, we leave to the reader to check that classical first-order models are a (trivial) special cases of the models introduced above.
  Classical relations take values in $\{0,1\}$ where $0$ is interpreted as ``true''.
  The unit ball is the whole of $M$. 
  The function $n_{\mbox-}$ is constantly $1$.
  To obtain the full strength of first-order logic one has to add equality as a predicate as it is absent from our logic.

  \item [2.] Secondly, any {\sc bbhu}-premodel $M$ is also a model as those in Section~\ref{uno} if we take as unit ball the whole of $M$.
  The language $L$ contains a relation symbol $d(x,y)$ for a metric and, possibly, symbols for all other functions and relations of $M$.
  As all relations of $M$ (including the metric) take values in the interval $[0,1]$, the function $n_{\mbox-}$ can be set to be the constant $1$.

  \item [3.] Now we consider an example that is non trivial and distant both from classical models and from {\sc bbhu}-models: weighted graphs.
  The set $L_{\rm fun}$ is empty and $L_{\rm rel}$ contains only a binary relation $r$.
  We require that $r^M(a,b)=r^M(b,a)\in[0,1]$.
  As unit ball take the whole of $M$.
  The function $n_{\mbox-}$ is constant $1$.
  

  \item [4.] Finally, and example where the unit ball is non trivial.
  Let $L$ be the language of Banach spaces. 
  Here we have only one symbol in $L_{\rm rel}$, the symbol $\|\mbox-\|$ for the norm.
  The set $L_{\rm fun}$ is the same as for real vector spaces in classical logic.
  Let $M$ be a Banach space and define a continuous model as follows.
  The interpretation of the symbols in $L_{\rm rel}\cup L_{\rm fun}$ is the natural one.
  The unit ball of $M$ is $uM=\{a\in M: \|a\|\le1\}$.
  If $\varphi(x)$ is the atomic formulas

  \ceq{\hfill\varphi(x)}{=}{\Big\|\sum_{i=1}^n\lambda_i x\,\Big\|}
  
  then 

  \ceq{\hfill n_{\varphi(x)}}{=}{\sum_{i=1}^n|\lambda_i|.}
  
  % Let $\varphi(x)$ be an atomic formula.
  % This has form $\|t(x)\|$ for some $t(x)\in L_{\rm trm}$.  
  % Note that $\sup\{\|t(a)\|: a\in U^{|x|}\}$ does not depend on $M$.
  % Therefore we can set it to be $n_{\varphi(x)}$

\end{itemize}

%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
\section{Conditions and types}

For $\varphi, \psi\in L(M)$ some closed formulas, we write \emph{$M\models\ \varphi\le\psi$} for $\varphi^M\le\psi^M$.
The meaning of \emph{$M\models\ \varphi=\psi$\/} and of \emph{$M\,\models\ \varphi<\psi$\/} is similar.

Expressions of the form $\varphi(x)\le0$ are called \emph{conditions}.
We write $M\models\exists x\,\varphi(x)\le0$ if $M\models\varphi(a)\le0$ for some $a\in M^{|x|}$.
Observe that $\varphi(x)=0$ is equivalent to $|\varphi(x)|\le0$ and that $\varphi(x)\le0$ is equivalent to $\big(\varphi(x)\vee0\big)=0$. 
So, when convenient we may use weak equalities to denote conditions.

The negation of a condition is called a \emph{co-conditions}.
So, $\varphi(x)\neq0$, $\varphi(x)<0$ or $\varphi(x)>0$ are co-conditions.

It is easy to see that conditions are cosed under logical disjunction and logical conjunction.

\ceq{\hfill M\models\varphi\vee\psi\le0}
{\Leftrightarrow}
{M\models\varphi\le0 \textrm{ and }M\models\psi\le0}

\ceq{\hfill M\models\varphi\wedge\psi\le0}{\Leftrightarrow}{M\models\varphi\le0 \textrm{ \ or \ }M\models\psi\le0}

Condition are also closed under universal quanfication over the unit ball.

\ceq{\hfill M\models\bigvee_x\varphi(x)\le0}{\Leftrightarrow}{M\models\forall x\in u\ \varphi(x)\le0}

Closure under existential quanfication is a more subtle point.
It is not true in general but it can be ensured by a small amount of saturation (cf.~Fact~\ref{fact_existential}).

A set of conditions is called a \emph{type\/} or, when $x$ is the empty tuple, a \emph{theory.}
For $p(x)\subseteq L(M)$, we define

\hfil\emph{$p(x)\le0$}\ \ =\ \ $\big\{\varphi(x)\le0 \quad :\quad  \varphi(x)\in p\big\}.$

Up to equivalence, all types have the form above.

Beware that $p(x)$ denotes just a set of formulas, the expression $p(x)\le0$ denotes a type.

We write \emph{$M\models p(a)\le0$} if $M\models\varphi(a)\le0$ for every $\varphi(x)\in p$.
We write \emph{$M\models \exists x\ p(x)\le0$} if $M\models p(a)\le0$ for some $a\in M^{|x|}$.

%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%
\section{Elementary relations}

The \emph{$A$-limit topology\/} on $M^{|x|}$ is the initial topology with respect to the functions interpret the formulas in $L(A)$. 
The sets $\big\{a\in M^{|x|}:\, \varphi^M(a)\le0\big\}$, as $\varphi(x)$ ranges over $L(A)$, form a base of closed sets for the $A$-limit topology.
Equivalently, we can take the sets $\big\{a\in M^{|x|}:\, \varphi^M(a)<0\big\}$ as a base of open sets.

The $A$-limit topology is a completely regular topology, almost by definition.
Typically, it is not T$_0$.

We say that $R\subseteq M\times N$ is an \emph{elementary relation\/} if

\ceq{\hfill \varphi^M(a)}{=}{\varphi^N(b)} \hfill for every $\varphi(x)\in L$ and $a,b\in M^{|x|}, N^{|x|}$ such that $aRb$. 

An \emph{elementary embedding\/} is an elementary relation that is functional, injective and total.

We write \emph{$M\equiv N$\/} when $\varnothing\subseteq M\times N$ is an elementary relation.
In word we say that $M$ and $N$ are \emph{elementarily equivalent.}
Let $I_A$ denote the diagonal relation on $A$.
We write \emph{$M\equiv_A N$\/} if $I_A\subseteq M\times N$ is an elementary relation.
In words, we say that $M$ and $N$ are elementary equivalent \emph{over $A$.}
Finally, we write \emph{$M\preceq N$\/} for $M\equiv_M N$ and say that $M$ is an \emph{elementary substructure\/} of $N$.

\begin{proposition}[Tarski-Vaught test]\label{prop_Tarski-Vaught} Let $N$ be a model and let $M\subseteq N$ be a substructure. 
Fix a tuple of variables $x$ of finite length.
Then the following are equivalent:
\begin{itemize}
\item[1.] $M\preceq N$;
\item[2.] $M^{|x|}$ is dense in $N^{|x|}$ w.r.t.\@ the $M\mbox{-}$limit topology on $N^{|x|}$;
\item[3.] for every $\varphi(x)\in L(M)$, if $\varphi(N)<0$ is non empty, then $N\models\varphi(b)<0$ for some $b\in M^{|x|}$.
\end{itemize}
\end{proposition}
\begin{proof}
  Equivalence 2$\Leftrightarrow$3 is tautological.
  Implication 1$\Rightarrow$2 is clear.
  To prove 3$\Rightarrow$1 we prove by induction on the syntax of $\varphi(x)$ that for every $\alpha\in{\mathds R}$

  \ceq{\hfill M\models\varphi(a)<\alpha}{\Leftrightarrow}{N\models\varphi(a)<\alpha} \hfill for every $a\in M^{|x|}$
  
  We use the equivalence above as induction hypothesis.
  As $M$ is a substructure of $N$, this equivalence holds for atomic $\varphi(x)$.
  We leave the case of the propositional connectives to the reader and consider only the case of the infimum quantifier.

  \ceq{\hfill N\,\models\,\smash{\bigwedge_x}\varphi(x,a)<\alpha}{\Leftrightarrow}{} there is a $b\in(uN)$ such that $N\models\varphi(b,a)<\alpha$

  \ceq{}{\Leftrightarrow}{} there is a $b\in N^{|y|}$ such that $N\models (ub<1$ and $\varphi(b,a)<\alpha)$

  \ceq{a.}{\Leftrightarrow}{} there is a $b\in M^{|x|}$ such that $N\models (ub<1$ and $\varphi(b,a)<\alpha)$

  \ceq{b.}{\Leftrightarrow}{M\,\models\,\bigwedge_x\varphi(x)<\alpha.}

We are using that $(ub<1$ and $\varphi(b,a)<\alpha)$ is equivalent to $(ub-1)\vee(\varphi(b,a)-\alpha)\le0$.
Implication $\Rightarrow$ in \textit{a} uses the assumption 3 and the equivalence in \textit{b} uses the induction hypothesis.
\end{proof}

\begin{remark}
In the Tarski-Vaught test for classical logic it is not necessary to require that $M$ is a substructure of $N$ as this is a consequence of the test.
In the continuous case this is necessary by the lack of a predicate for equality.\qed
%Still, we may drop this assumption when $M$ is metric complete. In fact, we can apply 2 as follows. For every function symbol $f$ and every $a\in M^{<\omega}$ the formula $d(fa,x)<\varepsilon$ has a witness in $M$ for all $\varepsilon\in{\mathds R}^+$. Hence $f{a}\in M$ follows from completeness.
\end{remark}

\begin{theorem}[Downward L\"owenheim-Skolem] For every $A\subseteq N$ there is a model $A\subseteq M\preceq N$ of cardinality $\le |L(A)|$.
\end{theorem}
\begin{proof} (Needs some checking.)
For every set $A$ there is a base for the $A\mbox{-}$topology that has cardinality $\le |L(A)|$. A set $M$ of the required cardinality that is dense in the  $M\mbox{-}$topology is obtained as in the classical downward L\"owenheim-Skolem theorem.
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Ultrapowers}\label{ultrapws}

% The content of this section can be generalized to ultraproducts at the cost of an extra index.
% We opt for the simpler variant as it suffices to prove the existence of saturated elementary extensions.


Firstly, we recall some standard notation about limits.
Let $I$ be a non-empty set.
Let $F$ be a filter on $I$.
If $r:I\to{\mathds R}$ and $\lambda\in{\mathds R}$ we write

\hfil$\displaystyle \lim_{i\uparrow F}r(i)=\lambda$

if $r^{-1}[A]\in F$ for every $A\subseteq{\mathds R}$ that is a neighborhood of $\lambda$.
When $r$ is bounded and $F$ is an ultrafilter, such a $\lambda$ always exists.

Let $I$ be an infinite set.
Let $\langle M_i:i\in I\rangle$ be a sequence of models.
Note that all models are required to have the same bounding function (as these are part of the language).
Let $F$ be an ultrafilter on $I$.

\begin{definition}\label{def_ultraproduct}
Write \emph{$U$\/} for the set of all functions $\hat a: I\to\bigcup_{i\in I}(uM_i)$ such that $\hat a\,i\in(uM_i)$.
We define the structure \emph{$N$\/} which we call an \emph{ultraproduct\/} of $\langle M_i:i\in I\rangle$.
A usual, if $M_i=M$ for all $i\in I$, then we say that $N$ is an \emph{ultrapower\/} of $M$.
\begin{itemize}
  \item[1.] the elements of $N$ are functions $\hat c: I\to \bigcup_{i\in I}M_i$ such that $\hat c\,i = t(\hat a\,i)$ for some $\hat a\in U^{|x|}$ and some term $t(x)\in L_{\rm trm}$ --- below we write $t(\hat a)$ for $\hat c$;
  \item[2.] if $f\in L_{\rm fun}$ and $r\in L_{\rm rel}$ and $t_1(\hat a),\dots,t_n(\hat a)$ are elements of  $N$ then
  \begin{itemize}
    \item[a.] $f^{N}\big(t_1(\hat a),\dots,t_n(\hat a)\big)=t(\hat a)$ where $t$ is the term obtained composing $f$ with $t_1,\dots,t_n$;
    \item[b.] \smash{$r^{N}\big(t_1(\hat a),\dots,t_n(\hat a)\big)=\lim\limits_{i\uparrow F}\ r^{M_i}\big(t_1(\hat a\,i),\dots,t_n(\hat a\,i)\big)$};
    \item[c.] $uN=U$.
  \end{itemize}
\end{itemize}
\end{definition}

Note that $uN$ satisfies the axioms in Definition~\ref{def_unitball}.

The limit in 2b of Definition~\ref{def_ultraproduct} exists because $F$ is an ultrafilter and it is finite because all $U_i$ have the same bounding functions.
In fact, the function $i\mapsto r^{M_i}\big(t_1(\hat a\,i),\dots,t_n(\hat a\,i)\big)$ is bounded by $n_{\varphi(x)}$, where $\varphi(x)=r(t_1(x),\dots,t_n(x))$.

\def\ceq#1#2#3{\parbox[t]{43ex}{$\displaystyle #1$}\parbox{5ex}{\hfil $#2$}{$\displaystyle #3$}}

\begin{proposition}[\L\v{o}\'s Theorem]
Let $N$ be as above and let $\varphi(x)\in L$. Then for every $\hat a\in N^{|x|}$, 

\ceq{\hfill \varphi^N\big(\hat a\big)}{=}{\lim_{i\uparrow F}\varphi^{M_i}\big(\hat ai\big).}

\end{proposition}

\begin{proof}
This is just the usual run-of-the-mill proof.
We proceed by induction on the syntax of $\varphi(x)$.
If $\varphi(x)$ is atomic holds the equality above holds by definition.
We spell out the proof for the infimum quantifier.
Assume inductively that

\ceq{\hfill \varphi^N\big(\hat a,\hat b\big)}
{=}
{\lim_{i\uparrow F}\varphi^{M_i}\big(\hat ai,\hat bi\big).}

We want to prove that 

\ceq{\hfill\Big(\bigwedge_x\varphi\big(\hat a,x\big)\Big)^N}
{=}
{\lim_{i\uparrow F}\Big(\bigwedge_x\varphi\big(\hat ai,x\big)\Big)^{M_i}}

By the interpretation of the infimum quantifier, this amounts to prove that

\ceq{\hfill\inf\big\{\varphi\big(\hat a,\hat b\big)^N\ :\ \hat b\in(uN)\big\}}
{=}
{\lim_{i\uparrow F}\inf\big\{\varphi\big(\hat ai,b\big)^{M_i}:\,b\in(uM_i)\big\}}

First we prove the $\le$ inequality.
Let $\alpha$ be an arbitrary positive real number.

\ceq{\textrm{Assume\ that\ for\ some\ }\hat b\in(uN)\hfill\varphi^N\big(\hat a,\hat b\big)}{<}{\alpha}.

\ceq{\textrm{By\ induction\ hypothesis}\hfill\lim_{i\uparrow F}\varphi^{M_i}\big(\hat ai,\hat bi\big)}{<}{\alpha},

\ceq{\textrm{then\ for\ some\ }u\in F\hfill\varphi^{U_i}\big(\hat ai,\hat bi\big)}{<}{\alpha}\quad for every $i\in u$.

\ceq{\textrm{Hence}\hfill \inf\Big\{\varphi^{M_i}\big(\hat ai,b\big):\,b\in(uM_i)\Big\}}{<}{\alpha}\quad for every $i\in u$.

\ceq{\textrm{Finally,}\hfill\lim_{i\uparrow F}\ \inf\Big\{\varphi^{M_i}\big(\hat ai,b\big):\,b\in(uM_i)\Big\}}{<}{\alpha}.

\smallskip
This proves the $\ge$ inequality.
As for the $\le$ inequality, assume that
\smallskip

\ceq{\hfill\lim_{i\uparrow F}\inf\Big\{\varphi\big(\hat ai,b\big)^{M_i}:\,b\in(uM_i)^{|x|}\Big\}}
{<}
{\alpha.}

Therefore, for some $u\in F$

\ceq{\hfill\inf\Big\{\varphi\big(\hat ai,b\big)^{M_i}:\,b\in(uM_i)^{|x|}\Big\}}{<}{\alpha}\quad for every $i\in u$.

\ceq{\hfill\inf\Big\{\varphi\big(\hat ai,b\big)^{M_i}:\,b\in(uM_i)^{|x|}\Big\}}{<}{\alpha}\quad for every $i\in u$.

\ceq{\textrm{Therefore,\ for\ some\ }\hat b\in(uN)^{|x|}\hfill \varphi^{M_i}\big(\hat ai,\hat bi\big)}{<}{\alpha}\quad for every $i\in u$.

\ceq{\textrm{Then}\hfill\lim_{i\uparrow F}\varphi^{M_i}\big(\hat ai,\hat bi\big)}{<}{\alpha,}

\ceq{\textrm{and\ finally}\hfill\vphantom{\bigwedge_x}\varphi^N\big(\hat a, \hat b\big)}{<}{\alpha.}

This proves the desired inequality.
\end{proof}

The following corollary of  \L\v{o}\'s Theorem is identical to its classical counterpart.

\begin{corollary}
  For every model $M$ and every ultrafilter $F$ on $I$, an infinite set, let $N$ be corresponding ultrapower of $M$.
  Then there is an elementary embedding of $M$ in $N$.\qed
\end{corollary}

We add the following easy remark for future reference.

\begin{remark}
  Let $R\subseteq N^2$ be the set of those pairs $(\hat a, \hat b)$ such that $\{i\in I:\hat ai=\hat bi\}\in F$.
  Then $R$ is an elementary relation.
\end{remark}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Compactness theorem}\label{compactness}

\def\ceq#1#2#3{\parbox[t]{20ex}{$\displaystyle #1$}\parbox{5ex}{\hfil $#2$}{$\displaystyle #3$}}

From \L\v{o}\'s Theorem we obtain a form of compactness with the usual argument.

A theory $T\le0$ is finitely consistent if for every $\varphi$, that is a disjunction of sentences in $T$, there is a model $M$ such that $M\models \varphi\le0$.
Note that it is implicit that all these models $M$ have the same bounding fuction.

\begin{theorem}[Compactness Theorem]\label{thm_compattezza}
  Every finitely consistent theory is consistent. 
  \end{theorem}
  
  \begin{proof}
  We construct a model $N$ of $T\le0$.
  Let $I$ be the set of closed formulas $\xi$ such that $\xi\le0$ holds in some model $M_\xi$.
  For every condition $\varphi\le0$ define $X_\varphi\subseteq I$ as follows
  
  \ceq{\hfill X_\varphi}{=}{\Big\{\xi\in I\ :\ \xi\le0\ \vdash\ \varphi\le0\Big\}}
  
  Note that $\varphi\le0$ is consistent if and only if $X_\varphi\neq\varnothing$.
  Moreover $X_{\varphi\vee\psi}\ =\ X_\varphi\cap X_\psi$. Then, as $T$  is finitely consistent, the set $B=\big\{X_\varphi\,:\,\varphi\in T\big\}$ has the finite intersection property.
  Extend $B$ to an ultrafilter $F$ on $I$.
  Define
  
  \ceq{\hfill N}{=}{\prod_{\xi\in I}M_\xi}
  
  Check that $N\models T\le0$. Let $\varphi\in T$. By \L\v{o}\'s Theorem,
  
  \ceq{\hfill \varphi^N}%
  {=}%
  {\lim_{\xi\uparrow F}\varphi^{M_\xi}.}
  
  Note that $X_\varphi\subseteq \big\{\xi\ :\ \varphi^{M_\xi}\le0\big\}$ and recall that $X_\varphi\in F$ whenever $\varphi\in T$.
  Therefore $\varphi^N\le0$.
  \end{proof}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Saturation}\label{saturation}

Let $p(x)\subseteq L(M)$.
%We say that the type $p(x)\le 0$ is \emph{uniform\/} if there is an $n\in{\mathds N}$ such that $M\models |\psi(a)|\le n$ for every $\psi(x)\in p$ and evey $a\in U^{|x|}$.
We say that $p(x)\le 0$ is \emph{finitely satisfied (in $uM$)\/} if for every disjunction of formulas in $p(x)$, say $\psi(x)$, there is an $a\in(uM)^{|x|}$ such that $M\models\psi(a)\le0$.  

We say that $M$ is \emph{$\lambda\mbox{-}$saturated\/} if for every $p(x)\subseteq L(A)$ as in 1 and 2 below, there is an $a\in(uM)^{|x|}$ such that $M\models p(a)\le0$.
\begin{itemize}
  \item[1.] $A\subseteq M$ has cardinality $<\lambda$;
  \item[2.] $p(x)\le0$ is finitely satisfied in $uM$.
\end{itemize}
If $\lambda$ is the cardinality of $M$ we say that $M$ is \emph{saturated.}

\begin{theorem}[???]
  Let $\lambda$ be an inaccessible cardinal larger than $|L|$ and $|M|$.
  Then $M$ has a saturated elementary superstructure of cardinality $M$. 
\end{theorem}

We conclude with an interesting property of $\omega$-saturated models.

\begin{fact}\label{fact_existential}
  Let $M$ is $\omega$-saturated.
  Then for every $\varphi(x)\in L(M)$ the following are equivalent
  \begin{itemize}
    \item[1.] $M\models\exists x\in u\ \varphi(x)\le0$;
    \item[2.] \smash{$M\models\displaystyle \bigwedge_x\ \varphi(x)\le0$}
  \end{itemize}
\end{fact}
\begin{proof}
  Only 2$\Rightarrow$1 requires a proof.
  Let $p(x)=\{\varphi(x)-\alpha: \alpha\in{\mathds R}^+\}$.
  If 2, then $p(x)\le0$ is finitely satisfied in $uM$.
  Hence 1 follows by saturation.
\end{proof}


% Let $p(x)\subseteq L(M)$ be a type.
% We say that $p(x)\le0$ is \emph{Cauchy\/} (in the $A$-limit uniformity) if for every $\varphi(x)\in L(A)$ and every $\varepsilon\in{\mathds R}^+$ there is a disjunction of formulas in $p(x)$, say $\psi(x)$, such that $\varnothing\neq\big(\psi(M)\le0\big)^2\subseteq V_{\varphi(x),\, \varepsilon}$.

% \begin{fact}
%   Let $\lambda=L(A)$.
%   If $M$ is $\lambda$-saturated then and $p(x)\subseteq L(M)$ is Cauchy, then $p(x)$ is realized in $M$.
% \end{fact}


% For every $\varphi(x)\in\ L(A)$ and $n\in{\mathds N}$ let 


% Suppose $N\models p(a)\le0$ and let $\big(\psi(M)\le0\big)^2\subseteq V_{\varphi(x),\, \varepsilon}$


%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Total and surjective elementary relations}

Let $R\subseteq M\times N$.
Define

\ceq{\hfill \langle R\rangle}{=}{\Big\{\big(t(a),t(b)\big)\ :\quad t(x)\in L_{\rm trm}\quad |x|<\omega\quad a,b\in M^{|x|}\quad aRb\Big\}}

Clearly, if $R$ is elementary, so is $\langle R\rangle$.
We say that $R$ is bounded if

\ceq{\hfill R}{=}{\big\langle R\ \cap\ (uM\times uN)\big\rangle}

We write ${\rm Tser}(M)$ for the set of elementary relations $R\subseteq M^2$ that are total and surjective.
We write  ${\rm Tser}(M/A)$ the set of relations in ${\rm Tser}(M)$ that contain $I_A$.

The following is immediate conseguence of the discrete nature of the unit ball.
For every $aRb$

\ceq{\hfill a\in uM}{\Leftrightarrow}{b\in uN.}





%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{The monster model}

Throughout the following we fix a saturated model \emph{$\EuScript U$\/} of cardinality $\kappa$, an inaccessible cardinal larger than $|L|$, where $|L|$ stands for $\max\big\{|L_{\rm fun}|,|L_{\rm rel}|,2^\omega\big\}$.

\begin{fact}
  Let $R\subseteq{\EuScript U}^2$ be an elementary relation of cardinality $<\kappa$.
  Then there is an  $S$ such that $R\subseteq S\in{\rm Tser}({\EuScript U})$.
\end{fact}

\begin{proof}
  
\end{proof}

Let $a\in(u\,{\EuScript U})^{|x|}$. 
We write $p(x)={\rm tp}(a/A)$ for $p(x)=\big\{\psi(x)\in L(A):{\EuScript U}\models \psi(a)\le0\big\}$.


\begin{fact}
  Let $a\in(u\,{\EuScript U})^{|x|}$, where $|x|<\kappa$.
  Let $A\subseteq{\EuScript U}$ have cardinality $<\kappa$.
  Then

  \ceq{\hfill p({\EuScript U})\le0}{=}{\big\{ha : h\in{\rm Aut}({\EuScript U}/A)\big\}}
\end{fact}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \section{Completeness vs.\@ saturation\quad !` please expand !}

% The $A$-limit uniformity on $M^{|x|}$ is the uniformity that has the following entourages 

% \ceq{\hfill V_{\varphi(x),\, \varepsilon}}{=}{\Big\{(a,b)\in M^{|x|}\times M^{|x|}\quad :\quad \big|\varphi^M(a)-\varphi^M(b)\big|<\varepsilon\Big\}}

% for $\varphi(x)\in L(A)$ and $\varepsilon\in{\mathds R}^+$. It is the coarsest uniformity that makes all formulas in $L(A)$ uniformly continuous.

% Let $p(x)\subseteq L(M)$ be a type.
% We say that $p(x)\le0$ is \emph{Cauchy\/} (in the $A$-limit uniformity) if for every $\varphi(x)\in L(A)$ and every $\varepsilon\in{\mathds R}^+$ there is a disjunction of formulas in $p(x)$, say $\psi(x)$, such that $\varnothing\neq\big(\psi(M)\le0\big)^2\subseteq V_{\varphi(x),\, \varepsilon}$.

% \begin{fact}
%   Let $\lambda=L(A)$.
%   If $M$ is $\lambda$-saturated then and $p(x)\subseteq L(M)$ is Cauchy, then $p(x)$ is realized in $M$.
% \end{fact}


% For every $\varphi(x)\in\ L(A)$ and $n\in{\mathds N}$ let 


% Suppose $N\models p(a)\le0$ and let $\big(\psi(M)\le0\big)^2\subseteq V_{\varphi(x),\, \varepsilon}$


\end{document} 
