\documentclass[12pt,letterpaper,oneside,reqno]{amsart}

\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{comment}
\usepackage{tikz}
\usepackage{xcolor}
\usepackage{datetime2} 
\usepackage{hyperref}

\usepackage[margin=1in]{geometry}
\usepackage{mathtools}
\usepackage{enumitem}
\usepackage{calc}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage[mathcal]{euscript}
%\usepackage{bbm}
%\usepackage{latexsym}
\usepackage{mathrsfs}
%\usepackage{stmaryrd}
\usepackage{stix}
\usepackage{dsfont}
\newcommand*{\TakeFourierOrnament}[1]{{%
\fontencoding{U}\fontfamily{futs}\selectfont\char#1}}
\renewcommand*{\danger}{\TakeFourierOrnament{66}}
\parindent0ex
\parskip1.2ex

\newcommand{\mylabel}[1]{{#1}\hfill}
\renewenvironment{itemize}
  {\begin{list}{$\triangleright$}{%
   \setlength{\parskip}{0mm}
   \setlength{\topsep}{.2\baselineskip}
   \setlength{\rightmargin}{0mm}
   \setlength{\listparindent}{0mm}
   \setlength{\itemindent}{0mm}
   \setlength{\labelwidth}{3ex}
   \setlength{\itemsep}{.2\baselineskip}
   \setlength{\parsep}{.2\baselineskip}
   \setlength{\partopsep}{0mm}
   \setlength{\labelsep}{1ex}
   \setlength{\leftmargin}{\labelwidth+\labelsep}
   \let\makelabel\mylabel}}{%
   \end{list}}

\newtheoremstyle{plain}% 〈name〉
{\parskip}% 〈Space above〉1
{\parskip}% 〈Space below 〉1
{\color{brown!20!red!40!black}}% 〈Body font〉
{}% 〈Indent amount〉2
{\bfseries}% 〈Theorem head font〉
{.}% 〈Punctuation after theorem head 〉
{.5em}% 〈Space after theorem head 〉3
{\llap{\thmnumber{#2}\hskip2mm}\thmname{#1}\thmnote{\kern1ex\bfseries(#3)}}% 〈Theorem head spec (can be left empty, meaning ‘normal’ )
\theoremstyle{plain}
\newtheorem{theorem}{Theorem}%[section]
\newtheorem{specialtheorem}{Theorem}
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{fact}[theorem]{Fact}
\newtheorem{corollary}[theorem]{Corollary}


\newtheorem{conjecture}[theorem]{Conjecture}
\newtheorem{question}[theorem]{Question}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{definitions}[theorem]{Definitions}
\newtheorem{example}[theorem]{Example}
\newtheorem{examples}[theorem]{Examples}
\newtheorem{convention}[theorem]{Convention}
\newtheorem{conventions}[theorem]{Conventions}
\newtheorem{notation}[theorem]{\breve Notation}

\newtheorem{remark}[theorem]{Remark}
\newtheorem{remarks}[theorem]{Remarks}

\theoremstyle{remark}
\newtheorem*{claim}{Claim}

\renewcommand*{\emph}[1]{%
   \smash{\tikz[baseline]\node[rectangle, fill=olive!25, rounded corners, inner xsep=0.5ex, inner ysep=0.2ex, anchor=base, minimum height = 2.7ex]{#1};}}

\linespread{1.2}
\author{C. L. C. L. Polymath}
\begin{document}
\title{Continuous logic for the classical logician}
\hfill\texttt{Branch:\ master\ \DTMnow}\bigskip
\maketitle
\raggedbottom




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{A class of structures}\label{uno}


\def\ceq#1#2#3{\parbox[t]{23ex}{$\displaystyle #1$}\parbox{6ex}{\hfil $#2$}{$\displaystyle #3$}}

As a motivating example, consider real vector spaces.
These are among the most simple strucures considered in model theory.
Now expand them with a norm.
The norm is a function that, given vector, outputs a real number, we may formalize this with a two sorted struture.
Ideally, we would like to have that an elementary extension of a normed space mantain the usal notion of real numbers\footnote{Non standard standard analists have no problem in expanding $\mathds{R}$. In these notes, for a change, we insist as $\mathds{R}$ should remain $\mathds{R}$ throughout.} but this is not possible with the usual notion of elementary extension.
A way out has been proposed by Henson and Iovino: restrict the notion of elementarity to a smaller class of formulas (which they call positive bounded formulas).
We elaborate on this idea generalizing it to arbitrary structures and a wider class of formulas.

\begin{definition}\label{def_0}
  Let \emph{$L$\/} be a one-sorted (first-order) language.
  Let \emph{$L'$\/}$\supseteq L$ be a two-sorted language.
  We consider the class of $L'$-structures of the form ${\EuScript M}=\langle  M,R\rangle$, where $M$ ranges over $L$-structures, while $R$ is fixed.

  We assume that $R$ is endowed with a locally compact Hausdorff topology.

  We require that function symbols of sort $M^n\times R^m\to R$ are interpreted in functions such that
  \begin{itemize}
    \item[i.] $f^{\EuScript M}:M^n\times R^m\to R$ is bounded, i.e.\@ its range is contained in a compact set;
    \item[ii.] $f^{\EuScript M}:M^n\times R^m\to R$ is continuous uniformly in $M$, this is made precise in Definition~\ref{def_unif_cont}.
  \end{itemize}
\end{definition}

% Caveat: occasionally, we work with totopogical spaces that are not ${\rm T}_0$.
% When we say that such a space is Hausdorff, we mean that its Kolmogorov quotient is Hausdorff.
  
There might be models in the class described in Definition~\ref{def_0} that do not have a saturated elementary extension in the same class.
As a remedy, below we carve out a set $\mathds{L}$ of formulas, $L\subseteq\mathds{L}\subseteq L'$, such that every model as in Definition~\ref{def_0} has an $\mathds{L}$-elementary extension that is $\mathds{L}$-saturated in the same class.
Our choice of $\mathds{L}$ is not the most general.
It is a compromise that avoids eccessive complications.

The function symbols of $L'$ fall in one of four groups accortding to their sort
  \begin{itemize}
    \item[0.] $M^n\to M$ (we assume, for simplicity, that these are also in $L$);
    \item[1.] $M^n\times R^m\to M$ with $m$ positive;
    \item[2.] $R^m\to R$ (we assume $L'$ contains symbols for \textit{all} continuous bounded functions of this sort);
    \item[3.] $M^n\times R^m\to R$ with $m$ positive.
  \end{itemize}
 
Below, \emph{$\mathds{T}_M$\/} denotes the set of the terms obtained composing function symbols as in 0 or 1 above.

By \emph{$\mathds{T}_R$\/} we denote the set of the terms obtained composing function symbols as in 2 or 3 above.

By \emph{$\mathds{T}_{R\circ M}$\/} we  denote the set of the terms obtained composing terms in $\mathds{T}_R$ with terms in $\mathds{T}_M$. 

Clearly, there are many more terms in $L'$; but we will restrict to the one above.

\begin{definition}\label{def_LL}
  Formulas in \emph{$\mathds{L}$\/} are constructed inductively from the following two sets of formulas
  \begin{itemize}
  \item[i.] formulas as $t(y;z)\in C$, where $C\subseteq R^n$ is compact\footnote{We confuse the relation symbols in $L'$ of sort $R^m$ with their interpretation and write $x\in C$ for $C(x)$} and $t(y;z)$ is a tuple of terms in $\mathds{T}_{R\circ M}$; 
  \item[ii.] all formulas in $L$.
  \end{itemize}
  We require that $\mathds{L}$ is closed under the Boolean connectives $\wedge$, $\vee$; the quantifiers $\forall$, $\exists$ of sort $M$; and the quantifier $\forall^C$, by which we mean a universal quanfier that ranges over the compact set $C\subseteq R^m$.
\end{definition}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Topological tools}\label{topology}

We recall the standard definition of $F$-limits.
Let $I$ be a non-empty set.
Let $F$ be a filter on $I$.
Let $Y$ be a topological space.
If $f:I\to Y$ and $\lambda\in Y$ we write

\hfil$\displaystyle F\mbox{-}\lim_{i}f(i)=\lambda$

if $f^{-1}[A]\in F$ for every $A\subseteq Y$ that is a neighborhood of $\lambda$.
Such a $\lambda$ is unique if $Y$ is Hausdorff.
When $F$ is an ultrafilter, and $Y$ is compact the limit always exists.

By $\beta\kern-1.5pt I$ we denote the set of ultrafilters on $I$. This is a topological space with the topology generated by the clopen sets $[A]=\{F\in\beta\kern-1.5pt I: A\in F\}$ as $A$ ranges over the subsets of $I$.
Let $X,Y$ be topological spaces, and assume $Y$ is Hausdorff and compact.
For any $f:I\times X\to Y$, we define
  
  \ceq{\hfill \bar f\ :\ \beta\kern-1.5pt I\times X}{\to}{Y}

  \ceq{\hfill  \langle F,\alpha\rangle\ }{\mapsto}{F\mbox{-}\lim_i f(i,\alpha)}


\begin{definition}\label{def_unif_cont}
  Let $I$ be a pure set.   
  We say that $f:I\times X\to Y$ is \emph{continuous uniformly in $I$} if  $\bar f\ :\ \beta\kern-1.5pt I\times X\to Y$ is continuous.
\end{definition}

The following propositions unravels the definition above into a more practicable form.

\begin{proposition}\label{prop_uc_esplicito}
  Let $X$ and $Y$ be as above.
  The following are equivalent
  \begin{itemize}
    \item[1.] $f:I\times X\to Y$ is continuous uniformly in $I$.
    \item[2.] For every $F\in\beta\kern-1.5pt I$ and $\alpha\in X$, and for every $V\subseteq Y$ open neighborhood of $\bar f(F,\alpha)$ there is $U\subseteq X$ open neighborhoodof $\alpha$ and an $A\in F$ such that $f(i,x)\in V$ for every $i\in A$ and every $x\in U$.
  \end{itemize}
\end{proposition}

% \begin{lemma}[???]
%   Let $X$ and $Y$ be as above.
%   Let $f:I\times X\to Y$ be continuous uniformly in $I$.
%   Let $\langle y_i\in Y : i\in I\rangle$.
%   For a given $F\in\beta\kern-1.5pt I$ define $\alpha=F\mbox{-}\lim_iy_i$.
%   Then $\bar f(F,\alpha)=F\mbox{-}\lim_i f(i,y_i)$.
% \end{lemma}

% \begin{lemma}[???]
%   With the same notation as the lemma above.
%   Let $g:I\times Y\to I\subseteq\beta\kern-1.5pt I$ be any function and let $\bar g:\beta\kern-1.5pt I\times Y\to \beta\kern-1.5pt I$ be defined as above.
%   Then $f(\bar g(F,\alpha),\alpha)=F\mbox{-}\lim_i f(g(i,y_i),y_i)$.
% \end{lemma}




\def\ceq#1#2#3{\parbox[t]{33ex}{$\displaystyle #1$}\parbox{5ex}{\hfil $#2$}{$\displaystyle #3$}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Henson-Iovino approximations}\label{ultrapws}


For $\varphi,\varphi'\in\mathds{L}$ (free variables are hidden) we say that $\varphi'>\varphi$ if $\varphi'$ can be obtained replacing each atomic formula $t\in C$ occurring in $\varphi$ by $t\in D$ for some compact neighborhood $D$ of $C$.
If no such atomic formulas occurs in $\varphi$, then $\varphi>\varphi$.

Note that this is a dense (pre)order of $\mathds{L}$.

Formulas in as in (i) of Definition~\ref{def_LL} do not occur under the scope of a negation, therefore we always have that $\varphi\to\varphi'$.
Vice versa, if $\varphi'$ for every $\varphi'>\varphi$, then $\varphi$.

The following lemma is required for the proof of \L\v o\'s Theorem in the next section.

\begin{lemma}\label{lem_HIapprox}
  Let $\alpha=F\mbox{-}\lim_i\alpha_i$ for some sequence $\langle \alpha_i:i\in I\rangle$ in $R$ and some $F\in\beta\kern-1.5pt I$.
  Let $\hat a:I\to M$.
  Let $\varphi(x;y)\in\mathds{L}$ be such that $\{i:{\EuScript M}\models\varphi(\hat ai;\alpha)\}\in F$. Then $\{i:{\EuScript M}\models\varphi'(\hat ai\,;\alpha_i)\}\in F$ for every $\varphi'>\varphi$.
\end{lemma}
\begin{proof}
  \noindent\llap{\textcolor{blue}{\Large\danger}\kern7ex}\ignorespaces
  By induction on the syntax.
  When $\varphi(x;y)$ is in $L$, it does not depend on $\alpha$, and the lemma is trivial.
  Suppose that $\varphi(x;y)$ is as in (i) of Definition~\ref{def_LL}, say it is the formula $t(x;y)\in C$, where $t(x;y)\in \mathds{T}_{R\circ M}$.
  
  By Definition~\ref{def_0} the map $f:i,\alpha \mapsto t^{\EuScript M}(\hat ai,\alpha)$ is uniformly continuous in $I$.
  Now, assume that $\{i:{\EuScript M}\models t(\hat ai;\alpha)\in C\}\in F$.
  Then $\bar f(F,\alpha)\in C$.
  Let $D$ be a compact neighborhood of $C$.
  By Proposition~\ref{prop_uc_esplicito}, there is a set $A\in F$ and $V\ni\alpha$ such that $f(i;\alpha')\in V$ for every $i\in A$ and $\alpha'\in V$.
  Then $\{i:{\EuScript M}\models\varphi'(\hat ai\,;\alpha_i)\}\in F$ follows.
  This completes the base case of the induction.

  Induction clear for the connectives $\vee$, $\wedge$ and for the existential quantifier of sort $M$.
  To deal with the universal quantifier of sort $M$ we assume inductively that for every $\varphi'>\varphi$

  \ceq{\hfill \big\{i:{\EuScript M}\models\varphi(\hat ai,\hat bi\,; \alpha)\big\}\in F}
  {\Rightarrow}
  {\big\{ i:{\EuScript M}\models\varphi'(\hat ai,\hat bi\,;\alpha_i)\big\}\in F}.
  
  We prove

  \ceq{1.\hfill \{i:{\EuScript M}\models\forall y\,\varphi(\hat ai,y\,; \alpha)\}\in F}
  {\Rightarrow}
  {\big\{ i:{\EuScript M}\models\forall y\,\varphi'(\hat ai,y\,;\alpha_i)\big\}\in F}
  
  Negate the r.h.s.\@ of the implication.
  Using that $F$ is an ultrafilter, there is a sequence $\hat b$ such that 

  \ceq{}
  { }
  {\big\{ i:{\EuScript M}\not\models\varphi'(\hat ai,\hat bi\,;\alpha_i)\big\}\in F}
  
  Assume the l.h.s.\@ of the implication,  for a contradiction.
  Then $\big\{i:{\EuScript M}\models\varphi(\hat ai,\hat bi\,; \alpha)\big\}\in F$ and, by induction hypothesis, $\big\{ i:{\EuScript M}\models\varphi'(\hat ai,\hat bi\,;\alpha_i)\big\}\in F$. A contradiction that proves (1).
  
  Induction for the quantifier $\forall^C$ is similar.
  Assume inductively that for every $\varphi'>\varphi$

  \ceq{\hfill \big\{i:{\EuScript M}\models\varphi(\hat ai\,; \alpha,\beta)\big\}\in F}
  {\Rightarrow}
  {\big\{ i:{\EuScript M}\models\varphi'(\hat a\,;\alpha_i,\beta_i)\big\}\in F}.
  
  We prove

  \ceq{2.\hfill \{i:{\EuScript M}\models\forall^C\!y\,\varphi(\hat ai,; \alpha,y)\}\in F}
  {\Rightarrow}
  {\big\{ i:{\EuScript M}\models\forall^C\!y\,\varphi'(\hat ai\,;\alpha_i,y)\big\}\in F}
  
 
  Negate the r.h.s.\@ of the implication.
  Using that $F$ is an ultrafilter, there is a sequence $\beta_i\in C$ such that 

  \ceq{}
  { }
  {\big\{ i:{\EuScript M}\not\models\varphi'(\hat ai\,;\alpha_i,\beta_i)\big\}\in F}
  
  As $C$ is compact, $F\mbox{-}\lim_i\beta_i$ exists, say it equals $\beta\in C$.
  Assume,  for a contradiction, that the l.h.s.\@ of the implication holds.
  Then $\big\{i:{\EuScript M}\models\varphi(\hat a\,; \alpha,\beta)\big\}\in F$ and, by induction hypothesis, $\big\{ i:{\EuScript M}\models\varphi'(\hat ai\,;\alpha_i,\beta_i)\big\}\in F$. A contradiction that proves (2) and, with it, the lemma.
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Ultrapowers}\label{ultrapws}

\def\ceq#1#2#3{\parbox[t]{25ex}{$\displaystyle #1$}\parbox{5ex}{\hfil $#2$}{$\displaystyle #3$}}

% Below we introduce a suitable notion of ultraproducts of some structures $\langle{\EuScript M}_i:i\in I\rangle$.
% We require that for each function symbol $f$ of sort $M^n\times R^m\to R$ there is a compact $C\subseteq R$ that contains the range of all the functions $f^{{\EuScript M}_i}$.
% Note that, otherwise, Fact~\ref{fact_termini1} below may fail.

To keep notation tidy, 
% we make two simplifications: 
% (1) we only consider ultrapowers; 
% (2) 
we do not consider formulas containing equality, so we need not take any quotient.
The generalization is straightforward.

Let $I$ be an infinite set.
Let $F$ be an ultrafilter on $I$.
Let ${\EuScript M}=\langle  M,R\rangle$ be an $L$-structure.

\begin{definition}\label{def_ultraproduct}
  We define a structure \emph{${\EuScript N}=\langle  N,R\rangle$\/} that we call the \emph{ultrapower\/} of ${\EuScript M}$.
  \begin{itemize}
    \item[1.] $N=M^I$ that is, it is the set of sequences $\hat a: I\to M$.
    \item[2.] If $f$ is a function of sort $ M^n\times R^m\to  M$ then $f^{\EuScript N}(\hat a;\alpha)$ is the sequence 
    $\langle f^{\EuScript M}\big(\hat ai;\alpha\big):i\in I\rangle$.
    \item[4.] If $f$ is a function of sort $ M^n\times R^m\to R$ then for every $\alpha\in R^m$
    $$
    f^{\EuScript N}\big(\hat a;\alpha\big)\ =\ F\mbox{-}\lim_if^{\EuScript M}\big(\hat ai;\alpha\big).
    $$ 
    \item[3.] if $r$ is a relation symbol of sort $M^n\times R^m$ then for every $\alpha\in R^m$
    $$
    {\EuScript N}\models r(\hat a; \alpha)
    \Leftrightarrow
    \big\{ i\in I\ :\ {\EuScript M}\models r(\hat ai;\alpha)\big\}\in F.
    $$
  \end{itemize}
\end{definition}

The following is immediate.

\begin{fact}\label{fact_termini1}
  The structure ${\EuScript N}$ satisfies Definition~\ref{def_0}.\hfill\textcolor{blue}{\Large\danger}
\end{fact}

The following is easily proved by induction on the syntax

\begin{fact}\label{fact_easy_induz}
  If  $t(y;z)\in \mathds{T}_M$ then 
  
  \ceq{\hfill t^{\EuScript N}\big(\hat a;\alpha\big)}{=}{\langle t^{\EuScript M}\big(\hat ai;\alpha\big): i\in I\rangle.}\hfill\qedsymbol
\end{fact}

We also have that

\begin{fact}
  If  $t(y;z)\in \mathds{T}_R$ then 
  
  \ceq{\#_0\hfill t^{\EuScript N}\big(\hat a;\alpha\big)}{=}{F\mbox{-}\lim_i t^{\EuScript M}\big(\hat ai;\alpha\big).}
\end{fact}

\begin{proof}
  By induction. 
  The fact holds by definition if $t$ is a function symbol.
  Therefore, we assume $\#_0$ as induction hypothesis and prove 

  \ceq{\#_1\hfill f^{\EuScript N}\Big(\hat a;t^{\EuScript N}\big(\hat a;\alpha\big)\Big)}{=}{F\mbox{-}\lim_i f^{\EuScript M}\Big(\hat ai;t^{\EuScript M}\big(\hat ai;\alpha\big)\Big).}

  By induction hypothesis 

  \ceq{\#_2\hfill f^{\EuScript N}\Big(\hat a;t^{\EuScript N}\big(\hat a;\alpha\big)\Big)}{=}{F\mbox{-}\lim_i f^{\EuScript M}\Big(\hat ai;\lambda\Big),}\hfill where $\displaystyle\lambda=F\mbox{-}\lim_i t^{\EuScript M}\big(\hat ai;\alpha\big).$
  

  Let $\sigma$ be the limit in $\#_2$.
  Let $V\subseteq R$ be an open set containing $\sigma$.
  Note that we can identify $F$ with an ultrafilter on $M^{|\hat a|}$ concentrated on ${\rm range}$ of $\hat a$.
  Apply 2 of Proposition~\ref{prop_uc_esplicito}, to obtain $A\in F$ and an open set $U\subseteq R$ containing $\lambda$ such that for every $i\in A$ and every $x\in U$
  
  \ceq{\hfill f^{\EuScript M}\big(\hat ai;x\big)}{\in}{V}.

  By induction hypothesis there is $B\in F$ be such that
  $t^{\EuScript M}\big(\hat ai;\alpha\big)\in U$ for every $i\in B$. 
  Therefore

  \ceq{\hfill f^{\EuScript M}\Big(\hat ai;t^{\EuScript M}\big(\hat ai;\alpha\big)\Big)}{\in}{V}
  
  for every $i\in A\cap B$.
  As $A\cap B\in F$, this sufficies to prove that $\sigma$ is also the limit in $\#_1$.
\end{proof}

From the two facts above it immediately follows that

\begin{fact}\label{fact_termini2}
  If $t(y;z)\in \mathds{T}_{R\circ M}$ then 
  
  \ceq{\hfill t^{\EuScript N}\big(\hat a;\alpha\big)}{=}{F\mbox{-}\lim_i t^{\EuScript M}\big(\hat ai;\alpha\big).}
  \hfill\qedsymbol
\end{fact}

% \begin{proof}
%   The proof is by induction.
%   Assume the claim is true for $t_R(y;z)$, a tuple of terms with values in $R$. 
%   Let $t_M(y,z)$ a tuple of terms with values in $M$.
%   Let $f$ be a function of sort $M^n\times R^m\to R$.
  
%   We need to prove that

%   \ceq{\hfill f^{\EuScript N}\Big(t^{\EuScript N}_M\big(\hat a;\alpha\big);t^{\EuScript N}_R\big(\hat a;\alpha\big)\Big)}{=}{F\mbox{-}\lim_i f\Big(t^{\EuScript M}_M\big(\hat ai;\alpha\big);t^{\EuScript M}_R\big(\hat ai;\alpha\big)\Big)}

%   As $\alpha$ is just a fixed parameter, we hide it from the notation.

%   \ceq{\hfill f^{\EuScript N}\Big(t^{\EuScript N}_M\big(\hat a\big);t^{\EuScript N}_R\big(\hat a\big)\Big)}{=}{F\mbox{-}\lim_i f\Big(t^{\EuScript M}_M\big(\hat ai\big);t^{\EuScript M}_R\big(\hat ai\big)\Big)}

%   By Fact~\ref{fact_termini1} we we can set $\hat b=t^{\EuScript N}_M\big(\hat a\big)$ and $b_i=t^{\EuScript M}_M\big(\hat ai\big)$ 


%   \ceq{\hfill f^{\EuScript N}\Big(\hat b;t^{\EuScript N}_R\big(\hat a\big)\Big)}{=}{F\mbox{-}\lim_i f\Big(b_i;t^{\EuScript M}_R\big(\hat ai\big)\Big)}

%   Now apply the induction hypothesis to obtain



  
%   Write $\lambda_\alpha$ for $t^{\EuScript N}_R\big(\hat a;\alpha\big)$.

  
%   Let $t_R(y;z)$ be a tuple of terms with values in $R$.
  

%   By Fact~\ref{fact_easy_induz} we can replace $t^{\EuScript N}_M\big(\hat a;\alpha\big)$ by a sequence of elements of $M$.
%   As we are reluctant to introduce a new letter, we absorb this sequence in the tuple $\hat a$.
%   Therefore the claim to prove is

%   \ceq{\hfill f^{\EuScript N}\big(\hat a;\lambda_\alpha\big)}{=}{F\mbox{-}\lim_i f\Big(\hat ai;t^{\EuScript M}_R\big(\hat ai;\alpha\big)\Big).}
 
%   Write $\mu$ for the limit on the r.h.s.\@ of the equality above. 
%   For every neighborhood $\mu\in S\subseteq R$ there is a $J\in F$ such that $f\Big(\hat ai;t^{\EuScript M}_R\big(\hat ai;\alpha\big)\Big)\in S$ for all $i\in J$  

%   (\ldots)
% \end{proof}


Finally, we prove $\mathds{L}$\llap{\rotatebox{30}{--}\kern1.5pt}\v{o}\'s Theorem.

\def\ceq#1#2#3{\parbox[t]{22ex}{$\displaystyle #1$}\parbox{5ex}{\hfil $#2$}{$\displaystyle #3$}}

\begin{theorem}\label{thm_Los}
  Let ${\EuScript N}$ be as above and let $\varphi(x;y)\in\mathds{L}$.
  Then for all $\hat a\in N^{|x|}$ and all $\alpha\in R^{|y|}$

  \ceq{\hfill {\EuScript N}\models\varphi(\hat a; \alpha)}
  {\Leftrightarrow}
  {\big\{ i\in I\ :\ {\EuScript M}\models\varphi'(\hat ai;\alpha)\big\}\in F \ \textrm{for every }\varphi'>\varphi.}

\end{theorem}
\begin{proof}
  By induction on the syntax.
  If $\varphi(x;y)\in L$ then the theorem reduces to the classical \L\v{o}\'s Theorem. Then, suppose that $\varphi(x;y)$ is as in (i) of Definition~\ref{def_LL}, say it is the formula $t(x;y)\in C$, where $t(x;y)\in \mathds{T}_{R\circ M}$.
  
  Assume ${\EuScript N}\models t(\hat a,\alpha)\in C$.
  If $D$ is a compact neighborhood of $C$ then $D$ is also a neighborhood of $t^{\EuScript N}(\hat a,\alpha)$.
  Hence, by the definition of $F$-limit, $\big\{ i:{\EuScript M}\models t(\hat ai,\alpha)\in D\big\}\in F$.
  Vice versa, assume ${\EuScript N}\models t(\hat a,\alpha)\notin C$.
  Let $D$ be a compact neighborhood of $C$ such that $t^{\EuScript N}(\hat a,\alpha)\notin D$. 
  By Fact~\ref{fact_termini2} and the definition of $F$-limit, $\big\{ i:{\EuScript M}\models t(\hat ai,\alpha)\notin D\big\}\in F$.

  This completes the proof of the base case of the induction.

  Induction for the connectives $\vee$ and $\wedge$ is clear.
  To deal with the quantifiers of sort $M$ we assume inductively that 

  \ceq{\hfill {\EuScript N}\models\varphi(\hat a,\hat b\,; \alpha)}
  {\Leftrightarrow}
  {\big\{ i\in I\ :\ {\EuScript M}\models\varphi'(\hat ai,\hat bi\,;\alpha)\big\}\in F \ \textrm{for every }\varphi'>\varphi.}
  
  First we prove

  \ceq{1.\hfill {\EuScript N}\models\forall y\,\varphi(\hat a,y\,; \alpha)}
  {\Leftrightarrow}
  {\big\{ i\in I\ :\ {\EuScript M}\models\forall y\,\varphi'(\hat ai,y\,;\alpha)\big\}\in F \ \textrm{for every }\varphi'>\varphi.}


  ($\Leftarrow$) Assume ${\EuScript N}\not\models\varphi(\hat a,\hat b; \alpha)$ for some $\hat b$.
  By induction hypothesis, $\big\{ i: {\EuScript M}\models\varphi'(\hat ai,\hat bi;\alpha)\big\}\notin F$ for some $\varphi'>\varphi$.
  A fortiori $\big\{ i:{\EuScript M}\models\forall y\,\varphi'(\hat ai,y;\alpha)\big\}\notin F$ as required.

  ($\Rightarrow$) Assume that $\big\{ i:{\EuScript M}\not\models\forall y\,\varphi'(\hat ai,y;\alpha)\big\}\in F$.
  Choose $\hat b$ such that $\big\{ i:{\EuScript M}\not\models\varphi'(\hat ai,\hat bi;\alpha)\big\}\in F$.
  If for a contradiction ${\EuScript N}\models\forall y\,\varphi(\hat a,y; \alpha)$, 
  then in particular ${\EuScript N}\models\varphi(\hat a,\hat b; \alpha)$.
  By induction hypothesis, $\big\{ i:{\EuScript M}\models\varphi'(\hat ai,\hat bi;\alpha)\big\}\in F$ a contradiction. This completes the proof of (1).
  
  Now we prove (the argument, which we repeat for convinience, is dual to the one above)

  \ceq{2.\hfill {\EuScript N}\models\exists y\,\varphi(\hat a,y\,; \alpha)}
  {\Leftrightarrow}
  {\big\{ i\in I\ :\ {\EuScript M}\models\exists y\,\varphi'(\hat ai,y\,;\alpha)\big\}\in F \ \textrm{for every }\varphi'>\varphi.}

  ($\Rightarrow$) Assume ${\EuScript N}\models\varphi(\hat a,\hat b; \alpha)$ for some $\hat b$.
  By induction hypothesis, $\big\{ i: {\EuScript M}\models\varphi'(\hat ai,\hat bi;\alpha)\big\}\in F$ for every $\varphi'>\varphi$.
  A fortiori $\big\{ i:{\EuScript M}\models\exists y\,\varphi'(\hat ai,y\,;\alpha)\big\}\in F$ as required.

  ($\Leftarrow$) Assume that $\big\{ i:{\EuScript M}\models\exists y\,\varphi'(\hat ai,y;\alpha)\big\}\in F$ for every $\varphi'>\varphi$.
  Choose some $\hat b$ such that $\big\{ i:{\EuScript M}\models\varphi'(\hat ai,\hat bi;\alpha)\big\}\in F$.
  Suppose for a contradiction that ${\EuScript N}\not\models\exists y\,\varphi(\hat a,y\,; \alpha)$.
  Then, in particular, ${\EuScript N}\not\models\varphi(\hat a,\hat b\,; \alpha)$.
  By induction hypothesis, $\big\{ i:{\EuScript M}\models\varphi'(\hat ai,\hat bi\,;\alpha)\big\}\notin F$ for some $\varphi'>\varphi$, a contradiction. This completes the proof of (2).
  
  Finally, to deal with the quantifier $\forall^C$ we assume inductively that 
 
  \ceq{\hfill {\EuScript N}\models\varphi(\hat a; \alpha, \beta)}
  {\Leftrightarrow}
  {\big\{ i\in I\ :\ {\EuScript M}\models\varphi'(\hat ai;\alpha, \beta)\big\}\in F \ \textrm{for every }\varphi'>\varphi}
  
  and prove that
 
  \ceq{3.\hfill {\EuScript N}\models\forall^C\!y\,\varphi(\hat a; \alpha, y)}
  {\Leftrightarrow}
  {\big\{ i\in I\ :\ {\EuScript M}\models\forall^C\!y\,\varphi'(\hat ai;\alpha,y)\big\}\in F \ \textrm{for every }\varphi'>\varphi.}
  
  ($\Leftarrow$) Assume ${\EuScript N}\not\models\varphi(\hat a; \alpha, \beta)$ for some $\beta$.
  By induction hypothesis, $\big\{ i: {\EuScript M}\models\varphi'(\hat ai;\alpha,\beta)\big\}\notin F$ for some $\varphi'>\varphi$.
  A fortiori $\big\{ i:{\EuScript M}\models\forall^C\!y\,\varphi'(\hat ai;\alpha,y)\big\}\notin F$ as required.

  ($\Rightarrow$) Assume that $\big\{ i:{\EuScript M}\not\models\forall^C\!y\,\varphi'(\hat ai;\alpha,y)\big\}\in F$ for some $\varphi'>\varphi$.
  Choose some $\beta_i\in C$ such that $\big\{ i:{\EuScript M}\not\models\varphi'(\hat ai;\alpha,\beta_i)\big\}\in F$ and let $\beta=F\mbox{-}\lim_i\beta_i$.
  If for a contradiction ${\EuScript N}\models\forall^C\!y\,\varphi(\hat a; \alpha, y)$, 
  then ${\EuScript N}\models\varphi(\hat a; \alpha, \beta)$ and, by induction hypothesis, $\big\{ i:{\EuScript M}\models\varphi''(\hat ai;\alpha,\beta)\big\}\in F$ for every $\varphi''>\varphi$.
  Fix $\varphi''$ such that $\varphi'>\varphi''>\varphi$ and obtain a contradiction from Lemma~\ref{lem_HIapprox} 
  This completes the proof of (3) and, with it, of the theorem.
\end{proof}

\end{document}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Saturation}

Let $p(x)\subseteq\mathds{L}(M)$.
We say that $p(x)$ is \emph{finitely satisfied in ${\EuScript M}$\/} if for every conjunction of formulas in $p(x)$, say $\varphi(x)$, there is an $a\in  M^{|x|}$ such that ${\EuScript M}\models\varphi(a)$.

The following definition is completely standard

\begin{definition}
  We say that ${\EuScript M}$ is \emph{$\mathds{L}$-saturated\/} if for every $p(x)$ as in 1 and 2 below, there is an $a\in  M^{|x|}$ such that ${\EuScript M}\models p(a)$
  \begin{itemize}
    \item[1.] $p(x)\subseteq\mathds{L}(A)$ for some $A\subseteq  M$ of cardinality $<|M|$ and $|x|=1$;
    \item[2.] $p(x)$ is finitely satisfied in ${\EuScript M}$.
  \end{itemize}
\end{definition}

Now we prove that every model embeds $\mathds{L}$-elementarily in an $\mathds{L}$-saturated one.
First we prove the following lemma.

\begin{lemma}\label{lem_compattezza}
  Every model ${\EuScript M}$ embeds $\mathds{L}$-elementarily in a model ${\EuScript N}$ that realizes all types as in the definition above.
\end{lemma}

\begin{corollary}\label{thm_compattezza}
  Every model ${\EuScript M}$ is an $\mathds{L}$-elementary subtructure of some saturated model ${\EuScript N}$ (possibly of inaccessible cardinality).
\end{corollary}

We denote by \emph{${\EuScript U}$\/} some large $\mathds{L}$-saturated structure which we call the \emph{monster model.}
The unit ball of ${\EuScript U}$ is denoted by \emph{$U$.}
The cardinality of ${\EuScript U}$ is an inaccessible cardinal that we denote by \emph{$\kappa$.}
Below we say \emph{model\/} for $\mathds{L}$-elementariy substructure of ${\EuScript U}$.


\begin{lemma}\label{lem_compactness_implication}
  Let $p(x)\subseteq\mathds{L}(A)$, where $A\subseteq U$ has small cardinality.
  Let $\varphi(x)\in\mathds{L}(U)$ be such that $p(x)\rightarrow\varphi(x)$.
  Then for every $\varphi'>\varphi$ there is a formula $\psi(x)$, conjunction of formulas in $p(x)$, such that $\psi(x)\rightarrow\varphi'(x)$.
\end{lemma}

\begin{proof}
  Let $\varepsilon>0$ be given.
  Suppose that $\psi(x)\wedge{}^{\neg\varepsilon\kern-2pt}\varphi(x)$ is consistent for every $\psi(x)$ that is conjunction of formulas in $p(x)$.
  By saturation there is a realization of $p(x)\cup{}^{\neg\varepsilon\kern-2pt}\varphi(x)$.
  By Fact~\ref{fact_immediate}, $p(x)\wedge\neg\varphi(x)$ is also consistent.
\end{proof}

\end{document}
%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%
\section{Equivalences}


We define an equivalence relation \emph{$(\sim_{\EuScript U})$\/} on $ U$ as follows

\ceq{1.\hfill a\,\sim_{\EuScript U}b}
{\Leftrightarrow}
{\Big({\EuScript U}\models t(a)= t(b)}
\ \ for every $t(x)\in\mathds{T}(U)\Big)$,

where $|x|=|a|=|b|=1$.

Hence $a\,\sim_{\EuScript U}b$ if and only if ${\rm d}_t(a,b)=0$ for all the pseudometrics ${\rm d}_t(\mbox{-},\mbox{-})$ defined below. 

\begin{definition}\label{def_uniformity}
  Let $x$ be a single variable.
  Let $t(x)\in\mathds{T}(U)^{<\omega}$ be a finte tuple of terms, say $t(x)=t_1(x),\dots,t_n(x)$.
  We define a pseudometric ${\rm d}_t(\mbox{-},\mbox{-})$ on $U$ as follows

  \ceq{\hfill\emph{${\rm d}_t(a,b)$}}{=}{\max_{i=1,\dots,n}\big\{|t_i^{\EuScript U}(a)-t_i^{\EuScript U}(b)|\big\}}

\end{definition}

We say that $a\in U$ is close to $M$ if 


\ceq{\hfill a\,\equiv^\mathds{L}_{\EuScript M}x}
{\rightarrow}
{a\sim_{\EuScript U}x},


\begin{proposition}
  The following are equivalent for every $a\in U$
  \begin{itemize}
    \item[1.] $a$ is close to ${\EuScript M}$;
    \item[2.] there is a net of elements of $M$ that converges to $a$. 
  \end{itemize}
\end{proposition}

\begin{proof}
  Let $p(x)={\rm tp}_\mathds{L}(a/U)$.

  (1$\Rightarrow$2) \ 
  The set of metrics ${\rm d}_t$ in Definion~\ref{def_uniformity} is a directed set under the relation of refinement.
  For every such metric ${\rm d}_t$ we have that

  \ceq{\hfill p_{\restriction M}(x)}{\rightarrow}{{\rm d}_t(x,a)\le0}

  By Lemma~\ref{lem_compactness_implication}, for every $\varepsilon>0$ there some consistent $\varphi(x)\in p$ such that

  \ceq{\hfill \varphi(x)}{\rightarrow}{{\rm d}_t(x,a)<\varepsilon}

  As $\varphi(x)$ is consistent in ${\EuScript M}$, there is some $b_{t,\varepsilon}\in M$ such that ${\rm d}_t(b_{t,\varepsilon},a)<\varepsilon$.
  This defines a net of elements of $M$ that converges to $a$.

  (2$\Rightarrow$1) \ 
  Let $I$ be a directed set.
  Let $\langle b_i:i\in I\rangle$ be a net of elements of $M$ that converges to $a$.
  Then, $c\sim_{\EuScript U} a$ for every $c\models p_{\restriction M}(x)$.
  Hence $p_{\restriction M}(x)\rightarrow p(x)$.
\end{proof}

\end{document}


\clearpage

  The language $L$ and its interpretation are subject to the following conditions.
  \begin{itemize}
  \item[1.] Functions only have one of the following sorts (for any $m,n\in\omega$)
  \begin{itemize}
    \item[a.] $\mathds{R}^n\to\mathds{R}$
    \item[b.] $ M^n\times{\breve M}^m\to\textrm{any of }  M,\ \breve M,\textrm{ or }\mathds{R}$
    % \item[c.] $ M^n\times{\breve M}^m\to \breve M$
    % \item[d.] $ M^n\times{\breve M}^m\to\mathds{R}$
  \end{itemize}
  \item[2.] There is a symbol for every (total) uniformly continuous function $\mathds{R}^n\to\mathds{R}$.
  \item[3.] The interpretation of functions symbolsof sort $M^n\to\mathds{R}$ have \textit{bounded\/} range.
  \item[4.] Every element of $\breve M$ is the image of some term of sort $ M^n\to \breve M$.  
  \item[5.] There is only one unary predicate: $x\le0$, of sort $\mathds{R}$.
  \end{itemize}
  Below, when the sort $\breve M$ is not displaied in the definitions, we assume that $M=\breve M$ and that the language contains the identity map ${\rm id}: M\to \breve M$.
  In other words, that $\breve M$ is redundant.


We call $M$ the \emph{unit ball\/} of ${\EuScript M}$: there is where the action takes place.
The auxiliary sort ${\breve M}$ can be ignored at a first reading.
Is is introduced as it makes the description of many important examples less contrived, e.g.\@ Example~\ref{ex_banach} below.

\begin{definition}
  We write \emph{$\mathds{T}(A)$\/} for the set of terms of sort $ M^n\times\mathds{R}^m\to\mathds{R}$ with parameters in some $A\subseteq  M$.
  Up to equivalence, these terms have the form $f(t(x),y)$, where $t(x)$ is a tuple of terms of sort $M^{|x|}\to\mathds{R}$, and $f$ is a function $\mathds{R}^{|t|+|y|}\to\mathds{R}$.
  Note that the terms $\mathds{T}(A)$ have bounded range.
\end{definition}

Now define a subset of the set first order formulas with parameters in a set $A\subseteq M$.
Note that we do not allow negation, nor quantification over $\breve M$.
Also, equality among elements of $M$ is excluded.

\begin{definition}
  We define the set of formulas \emph{$\mathds{L}(A)$\/} inductively
  \begin{itemize}
  \item[i.] $\mathds{L}(A)$ contains the atomic formula $t\le0$ for every term $t\in\mathds{T}(A)$.
  \item[ii.] It is closed under the Boolean connectives $\bot$, $\top$, $\wedge$, $\vee$, and the quantifiers $\forall$, $\exists$ of sort $ M$.
  \item[iii.] It is closed under the quantifier $\forall$ of sort $\mathds{R}$ relativized to any definable subset of $\mathds{R}$.
  \end{itemize}
\end{definition}

Note that in iii of the definition above, definability is intended with respect to $L(M)$, the full first order language of ${\EuScript M}$, which is strictly larger than $\mathds{L}(A)$.
In particular, if $\varphi(x,\varepsilon)\in\mathds{L}(A)$, also $\forall\varepsilon{>}0\;\varphi(x,\varepsilon)\in\mathds{L}(A)$.

\begin{example}[Banach spaces]\label{ex_banach}
  Given a Banach space  $V$ we define a structure ${\EuScript M}=\langle  M,\breve M,\mathds{R}\rangle$ as follows.
  Let $\breve M=V$ and let $M=\{a\in \breve M: \|a\|\le1\}$ be the closed unit ball of $V$.
  Besides the symbols mentioned above, $\mathds{L}$ contains a function symbol for the natural embedding ${\rm id}: M\to \breve M$.
  It also contains a symbol for the norm $\|\mbox-\|:\breve M\to\mathds{R}$.
  Finally, $\mathds{L}$ contains the usual symbols of the language of vector spaces.
  These have sort ${\breve M}^n\to \breve M$, for the appropiate $n\in\{0,1,2\}$.

  Terms of sort $M^{|x|}\to\mathds{R}$ have the form $f(t(x))$ where $f$ is a uniformly continuous function and

  \ceq{\hfill t(x)}{=}{\Big\|\sum_{i=1}^{|x|}\lambda_i x_i\,\Big\|.}

  Therefore, as for all $a\in M^{|x|}$

  \ceq{\hfill t^{{\EuScript M}}(a)}{\le}{\sum_{i=1}^{|x|}|\lambda_i|,}

  condition 3 of Definition~\ref{def_LL} is  satisfied.
  Conditions 4 is immediate.
\end{example}


\begin{example}[Metric spaces of finite diameter]\label{ex_metric}
  Given a metric space $(M,{\rm d})$ of finite diameter we define a structure ${\EuScript M}=\langle  M,\mathds{R}\rangle$ as follows.
  The only function symbols is ${\rm d}$.
  Note that 3 is satisfied because ${\rm d}$ is bounded.
\end{example}

%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%
\section{$\mathds{L}$-relations}\label{L-relations}

Equality between elements in the unit ball is not among the formulas that Definition~\ref{def_LL} enumerates in $\mathds{L}$.
Logic without equality is not uncommon in mathematics.
For instance, in the theory of integration equality beween functions is not significative notion.
Of course, there is a quick remedy to this.
One can work with equivalence classes of functions that coincide almost everywhere.
In this way, equality regains it meaning.
But this has some drawbacks.
In fact, this makes impossible to speak of the value that a function takes at a point and there are situations when this is inconvenient.

In our general setting, for similar reasons, structures that contain irrelevat copies of equivalent objects may offer a better grasp than terse quotiented structures.

Without equality, relations, rather than partial maps, are the natural tool to discuss elementarity. 

Let ${\EuScript M}$ and ${\EuScript N}$ be models.
We say that $R\subseteq M\times N$ is an \emph{$\mathds{L}$-(elementary) relation\/} between ${\EuScript M}$ and ${\EuScript N}$ (or on ${\EuScript M}$ if the two coicide) if for every $\varphi(x)\in\mathds{L}$

\ceq{\hfill{\EuScript M}\models\varphi(a)}{\Leftrightarrow}{{\EuScript N}\models\varphi(b)} \hfill for every $a$ and $b$ such that $a\mathbin{R}b$.

Recall that, when $a=a_1,\dots,a_n$ and $b=b_1,\dots,b_n$ are tuples, $a\mathbin{R}b$ stands for $a_i\mathbin{R}b_i$ for every $i\in\{1,\dots,n\}$.

We define an equivalence relation \emph{$(\sim_{\EuScript M})$\/} on $ M$ as follows

\ceq{1.\hfill a\,\sim_{\EuScript M\!}b}
{\Leftrightarrow}
{\Big({\EuScript M}\models\varphi(a)\leftrightarrow\varphi(b)}
\ \ for every $\varphi(x)\in\mathds{L}( M)\Big)$,

where $|x|=|a|=|b|=1$.
Note that this relation would be trivial had we included  in $\mathds{L}(M)$ equality between elements of $M$.

The following proposition is easily proved by induction on the syntax. 

\begin{proposition}
  The following are equivalent for every $a,b\in M$.
  \begin{itemize}
    \item[1.] $a\equiv_{\EuScript M}b$;
    \item[2.] ${\EuScript M}\models t(a)=t(b)$ for every $t(x)\in\mathds{T}(M)$, with $|x|=1$.\hfill\qedsymbol
  \end{itemize}
\end{proposition}

\begin{lemma}
  The relation $(\sim_{\EuScript M\!})\subseteq  M^2$ is an $\mathds{L}$-relation.
  Moreover, it is maximal among the $\mathds{L}$-relations on ${\EuScript M}$, i.e.\@ no $\mathds{L}$-relation properly contains $(\sim_{\EuScript M\!})$.
\end{lemma}

\begin{proof}
  Assume $a\sim_{\EuScript M\!}b$, where $a=a_1,\dots,a_n$ and $b=b_1,\dots,b_n$.
  Recall that this means that $a_i\sim_{\EuScript M\!}b_i$ for all $i\in\{1,\dots,n\}$.
  Let $\Delta$ denote the diagonal relation on $ M$.
  Note that $a_i\sim_{\EuScript M\!}b_i$ is equivalent to saying that $\Delta\cup\{(a_i,b_i)\}$ is an $\mathds{L}$-relation.
  As $\mathds{L}$-relations are closed under composition $\Delta\cup\big\{(a_1,b_1),\dots,(a_n,b_n)\big\}$ is $\mathds{L}$-elementary.
  It follows that for every $\varphi(x)\in\mathds{L}$

  \ceq{2.\hfill{\EuScript M}\models\varphi(a)}{\Leftrightarrow}{{\EuScript M}\models\varphi(b).}
  
  This proves that $(\sim_{\EuScript M\!})$ is an $\mathds{L}$-relation.
  Finally, maximality is immediate.
  % Suppose $E$ and equivalence $\mathds{L}$-relation on ${\EuScript M\!}$ properly containing $(\sim_{\EuScript M\!})$.
  % Pick $a,b\in M$ such that $a\mathbin{E}b$ and $a\not\sim_{\EuScript M\!}b$.
\end{proof}


\begin{lemma}
  Let $R\subseteq  M\times N$ be total and surjective $\mathds{L}$-relation.
  Then there is a unique maximal $\mathds{L}$-relation containing $R$.
  This maximal $\mathds{L}$-relation is equal to both $(\sim_{\EuScript M\!})\,R$ and $R\,(\sim_{\EuScript N\!})$, where justapposition of relations stands for composition.
\end{lemma}
\begin{proof}
  It is immediate to verify that $(\sim_{\EuScript M\!})\,R$ is an $\mathds{L}$-relation containing $R$.
  Let $S$ be any maximal $\mathds{L}$-relation containing $R$.
  By maximality, $(\sim_{\EuScript M\!})\,S=S$.
  As $S$ is a total relation $(\sim_{\EuScript M\!})\subseteq SS^{-1}$.
  Therefore, by the lemma above, $(\sim_{\EuScript M\!})=SS^{-1}$.
  As $R$ is a surjective relation, $S\subseteq S\,S^{-1}R$.
  Finally, by maximality, we conclude that $S=(\sim_{\EuScript M\!})\,R$.
  A similar argument proves that $S=R\,(\sim_{\EuScript N\!})$.
\end{proof}

We write ${\rm Aut}({\EuScript M})$ for the set of maximal, total and surjective, $\mathds{L}$-relations $R\subseteq  M^2$.
The choice of the symbol Aut is motivated by the lemma above.
In fact any such relation $R$ induces a unique automorphism on the (properly defined) quotient structure ${\EuScript M}/{\sim_{\EuScript M\!}}$.

% Thought in most situations one could dispense with ${\EuScript M}$ in favour of ${\EuScript M}/{\sim_{\EuScript M\!}}$, in concrete cases one has a better grip on the first than on the latter.
% Therefore below we insist in working with $\mathds{L}$-relations in place of $\mathds{L}$-elementary maps.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Elementary substructures}

An \emph{$\mathds{L}$-(elementary) embedding\/} is an $\mathds{L}$-relation that is functional, injective and total.

When $\varnothing$ is an $\mathds{L}$-relation between ${\EuScript M}$ and ${\EuScript N}$ we say that ${\EuScript M}$ and ${\EuScript N}$ are \emph{$\mathds{L}$-(elementary) equivalent\/} and write \emph{${\EuScript M}\equiv^\mathds{L} {\EuScript N}$.}
When $A\subseteq M\cap N$, we write \emph{${\EuScript M}\equiv_{\!A}{\EuScript N}$\/} if $\Delta_{\!A}$, the diagonal relation on $A$, is an $\mathds{L}$-relation.
In words, we say that ${\EuScript M}$ and ${\EuScript N}$ are $\mathds{L}$-equivalent \emph{over $A$.}
Finally, we write \emph{${\EuScript M}\preceq^\mathds{L}{\EuScript N}$\/} when ${\EuScript M}\subseteq{\EuScript N}$, i.e.\@ ${\EuScript M}$ is a substructure of ${\EuScript N}$, and ${\EuScript M}\equiv_M^\mathds{L}{\EuScript N}$.
In words, we say that ${\EuScript M}$ is an \emph{$\mathds{L}$-(elementary) substructure\/} of ${\EuScript N}$.


Let $A\subseteq  M$.
The \emph{$\mathds{L}(A)$-topology\/} on $M^{|x|}$ is the topology that has, as a base of closed sets, the $\mathds{L}(A)$-definable sets.

The $\mathds{L}(A)$-topology is not T$_0$.
The following lemma asserts that to obtain a Hausdorff topology it suffices to quotient by $\equiv_A^\mathds{L}$.
This is the so-called the Kolmogorov quotient.

We need the following definitions that will be relevant in many of the proofs below.
If $\varphi(x)\in L(A)$ and $\varepsilon>0$ we write \emph{${}^{\varepsilon\kern-2pt}\varphi(x)$\/} for the formula obtained by replacing every occurence in $\varphi$ of the atomic formula $t(x)\le0$ with $t(x)-\varepsilon\le0$ or, less pedantically, $t(x)\le\varepsilon$.
We write \emph{${}^{\neg\varepsilon\kern-2pt}\varphi(x)$\/} for the formula obtained by replacing $t(x)\le0$ with $\varepsilon\le t(x)$.

Note that, if $\varphi(x)\in\mathds{L}(A)$ then ${}^{\varepsilon\kern-2pt}\varphi(x),\ {}^{\neg\varepsilon\kern-2pt}\varphi(x)\in\mathds{L}(A)$.
Moreover, the positivity of the formulas in $\mathds{L}(A)$ ensures that

\ceq{\hfill\varphi(x)}{\to}{{}^{\varepsilon\kern-2pt}\varphi(x)}

\ceq{\textrm{and}\hfill {}^{\neg\varepsilon\kern-2pt}\varphi(x)}{\to}{\neg\varphi(x)}

The following fact is immediate.

\begin{fact}\label{fact_immediate}
  For every $a\in M^{|x|}$ and very $\varphi(x)\in\mathds{L}(A)$
  
  \ceq{\hfill{\EuScript M}\ \models\ \forall\varepsilon > 0\ {}^{\phantom{\neg}\varepsilon\kern-2pt}\varphi(a)}{\Leftrightarrow}{{\EuScript M}\ \models\ \varphi(a)}
  
  \ceq{\hfill{\EuScript M}\ \models\ \exists\varepsilon > 0\ {}^{\neg\varepsilon\kern-2pt}\varphi(a)}{\Leftrightarrow}{{\EuScript M}\ \models\ \neg\varphi(a)}\hfill\qedsymbol
\end{fact}

\begin{lemma}
  If $a\nequiv_A^\mathds{L}b$ are two elements of $M^{|x|}$ then there are two formulas $\varphi(x), \psi(x)\in\mathds{L}(A)$ such that $\varphi(a)$ and $\psi(b)$ hold and $\varphi(M)\cap\psi(M)=\varnothing$.
\end{lemma}

\begin{proof}
  Let $\varphi(x)\in\mathds{L}(A)$ be such that $\varphi(a)$ and $\neg\varphi(b)$.
  By the fact above ${}^{\neg\varepsilon\kern-2pt}\varphi(b)$ holds for some $\varepsilon>0$.
  Then let $\psi(x)={}^{\neg\varepsilon\kern-2pt}\varphi(x)$.
\end{proof}

\begin{proposition}[Tarski-Vaught test]\label{prop_Tarski-Vaught} Let ${\EuScript M}\subseteq{\EuScript N}$.
  Let $x$ be a single variable.
  Then the following are equivalent
  \begin{itemize}
    \item[1.] ${\EuScript M}\preceq^\mathds{L}{\EuScript N}$;
    % \item[2.] $M$ is dense in $N$ w.r.t.\@ the $\mathds{L}(M)$-topology on $N$;
    \item[2.] for every $\varphi(x)\in \mathds{L}(M)$, if $\varphi(N)\neq\varnothing$, then ${\EuScript N}\models\varphi(b)$ for some $b\in M$.
  \end{itemize}
\end{proposition}
\begin{proof}
  % Equivalence 2$\Leftrightarrow$3 is tautological.

  

  Implication 1$\Rightarrow$2 is clear.
  As for 2$\Rightarrow$1, we prove by induction on the syntax of $\varphi(z)$, where $z$ is a finite tuple, that

  \ceq{3.\hfill {\EuScript N}\models\varphi(a)}{\Leftrightarrow}{{\EuScript M}\models\varphi(a)} \hfill for every $a\in  M^{|z|}$

  For $\varphi(z)$ atomic 3 follows from ${\EuScript M}\subseteq{\EuScript N}$.
  Induction for the connectives $\wedge$ and $\vee$ is straightforward.
  Induction for the existential quantifier is as in the classical case.
  We prove the case of the universal quantifier over the unit ball.
  Assume that 3 holds for the formula $\psi(z,y)$ and prove that it holds for the formula $\forall y\,\psi(z,y)$.
  The the implication $\Rightarrow$ is immediate.
  To prove $\Leftarrow$, note that

  \ceq{\hfill{\EuScript N}\models\neg\forall y\ \psi(a,y)}{\Rightarrow}{{\EuScript N}\models\forall y\,{}^{\neg\varepsilon}\psi(a,y)} \hfill for some $\varepsilon>0$

  \ceq{}{\Rightarrow}{{\EuScript M}\models\forall y\,{}^{\neg\varepsilon\kern-.2pt}\psi(a,y)}\hfill for some $\varepsilon>0$

  \ceq{}{\Rightarrow}{{\EuScript M}\models\neg\forall y\ \psi(a,y)}.

  Induction for the universal quantifier of sort $\mathds{R}$ is immediate.
\end{proof}

% \begin{theorem}[Downward L\"owenheim-Skolem] For every $A\subseteq \breve N$ there is a model $A\subseteq  M\preceq \breve N$ of cardinality $\le |L(A)|$.
% \end{theorem}
% \begin{proof} (Needs some checking.)
%   For every set $A$ there is a base for the $A\mbox{-}$topology that has cardinality $\le |L(A)|$. A set $ M$ of the required cardinality that is dense in the  $ M\mbox{-}$topology is obtained as in the classical downward L\"owenheim-Skolem theorem.
% \end{proof}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Ultraproducts}\label{ultrapws}

\def\ceq#1#2#3{\parbox[t]{20ex}{$\displaystyle #1$}\parbox{5ex}{\hfil $#2$}{$\displaystyle #3$}}


We recall some standard definitions about limits.
Let $I$ be a non-empty set.
Let $F$ be a filter on $I$.
If $f:I\to{\mathds R}$ and $\lambda\in{\mathds R}\cup\{\pm\infty\}$ we write

\hfil$\displaystyle \lim_{i\to F}f(i)=\lambda$

if $f^{-1}[A]\in F$ for every $A\subseteq{\mathds R}\cup\{\pm\infty\}$ that is a neighborhood of $\lambda$.
Such a $\lambda$ is unique and, when $F$ is an ultrafilter, it always exists.
When $f$ is bounded, $\lambda\in\mathds{R}$.

Let $I$ be an infinite set.
Let $\langle {\EuScript M}_i:i\in I\rangle$ be a sequence of structures, say  ${\EuScript M}_i=\langle  M_i,\breve M_i,\mathds{R}\rangle$, that are \emph{uniformly bounded,} that is, the bounds in 3 of Definition~\ref{def_LL} are the same for all ${\EuScript M}_i$.

Let $F$ be an ultrafilter on $I$.

\begin{definition}\label{def_ultraproduct}
  We define a structure \emph{${\EuScript N}=\langle  N,\breve N,\mathds{R}\rangle$\/} that we call the \emph{ultraproduct\/} of the models $\langle{\EuScript M}_i:i\in I\rangle$.
  \begin{itemize}
    \item[1.] $N$ comprise the sequences $\hat a: I\to\bigcup_{i\in I} M_i$ such that $\hat a\,i\in  M_i$.
    \item[2.] $\breve N$ comprise the sequences $t^{\EuScript N}(\hat a)$ of the form $t^{{\EuScript M}_i}(\hat ai)$, where $t(x)$ is a term of sort $ M^n\to \breve M$.
    \item[3.] If $f$ is a function of sort $ M^n\times{\breve M}^m\to  M$ then $f^{\EuScript N}(\hat a,t^{{\EuScript N}}\big(\hat c)\big)$ is the sequence 
    $f^{{\EuScript M}_i}\big(\hat ai,t^{{\EuScript M}_i}(\hat ci)\big)$.
    \item[4.] Similarly when $f$ is of sort $ M^n\times{\breve M}^m\to \breve M$.
    \item[5.] If $f$ is a function of sort $ M^n\times{\breve M}^m\to\mathds{R}$ then 
    $$
    f^{\EuScript N}\big(\hat a,t^{\EuScript N}(\hat c)\big)\ =\ \lim_{i\to F}f^{{\EuScript M}_i}\big(\hat ai,t^{{\EuScript M}_i}(\hat ci)\big).
    $$ 
  \end{itemize}
  As usual, if ${\EuScript M}_i={\EuScript M}$ for all $i\in I$, we say that ${\EuScript N}$ is an \emph{ultrapower\/} of ${\EuScript M}$.
\end{definition}

The limit in 5 of the definition above always exists because $F$ is an ultrafilter.
It is finite because all models ${\EuScript M}_i$ have the same bounds.

The following fact is easily proved by induction on the syntax.

\begin{fact}
  For every term $t(x)$ of sort $ M^n\to\mathds{R}$  
  
  \ceq{\hfill t^{\EuScript N}\big(\hat a\big)}{=}{\lim_{i\to F}t^{{\EuScript M}_i}\big(\hat ai\big).}\hfill\qedsymbol
\end{fact}

Finally, we prove 

\begin{proposition}[\L\v{o}\'s Theorem]\label{thm_Los}
  Let ${\EuScript N}$ be as above and let $\varphi(x,y)\in\mathds{L}(A)$.
  Let $\hat a\in N^{|x|}$.
  Then there is a function $u_{-}:\mathds{R}^+\to F$ such that for every $\lambda\in\mathds{R}^{|y|}$

  \ceq{1.\hfill {\EuScript N}\models\varphi(\hat a, \lambda)}
  {\Rightarrow}
  {u_\varepsilon\subseteq\big\{ i\in I\ :\ {\EuScript M}_i\models{}^{\varepsilon\kern-2pt}\varphi(\hat ai,\lambda)\big\} \ \textrm{for every }\varepsilon>0.}

  \ceq{2.\hfill {\EuScript N}\not\models\varphi(\hat a, \lambda)}
  {\Rightarrow}
  {u_\varepsilon\subseteq\big\{ i\in I\ :\ {\EuScript M}_i\not\models{}^{\varepsilon\kern-2pt}\varphi(\hat ai,\lambda)\big\} \ \textrm{for some }\varepsilon>0.}

\end{proposition}
\begin{proof}
  Suppose that $\varphi(x,y)$ is atomic, say

  \ceq{\hfill\varphi(x,y)}
  {=}
  {f(t(x),\,y)\le0,} 
  
  where $t$ is a tuple of terms of sort  $ M^{|x|}\to\mathds{R}$ and $f$ is a uniformly continuous function $\mathds{R}^{|t|+|y|}\to\mathds{R}$. 


  Let $\beta'\in\mathds{R}^{|t|}$ be such that
  $\displaystyle\lim_{i\to F}\ t(\hat ai)=\beta'$.

  Given $\varepsilon>0$, let $B_\varepsilon$ be a neighborhood of $\beta'$ such that 
  
  \ceq{}{\ }{\big|f(\beta,\,\lambda)-f(\beta',\lambda)\big|<\varepsilon}\hfill for every $\beta\in B_\varepsilon$ and every $\lambda\in\mathds{R}^{|y|}$.
  
  Such a neighborhood exists by the uniform continuity of $f$.
  Finally, to obtain 1 and 2 above it suffices to define 

  \ceq{\hfill u_\varepsilon}{=}{\big\{i\ :\  t(\hat a i)\in B_\varepsilon\big\}.}

  The rest of the inductive proof is straightforward and is left to the reader.
\end{proof}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Saturation}


Let $p(x)\subseteq\mathds{L}(M)$, where $x$ has the sort of the unit ball.
We say that $p(x)$ is \emph{finitely satisfied in ${\EuScript M}$\/} if for every conjunction of formulas in $p(x)$, say $\varphi(x)$, and for every $\varepsilon>0$, there is an $a\in  M^{|x|}$ such that ${\EuScript M}\models{}^{\varepsilon\kern-2pt}\varphi(a)$.

The following definition is completely standard

\begin{definition}
  We say that ${\EuScript M}$ is \emph{$\mathds{L}$-saturated\/} if for every $p(x)$ as in 1 and 2 below, there is an $a\in  M^{|x|}$ such that ${\EuScript M}\models p(a)$
  \begin{itemize}
    \item[1.] $p(x)\subseteq\mathds{L}(A)$ for some $A\subseteq  M$ of cardinality $<|M|$ and $|x|=1$;
    \item[2.] $p(x)$ is finitely satisfied in ${\EuScript M}$.
  \end{itemize}
\end{definition}

Now we prove that every model embeds $\mathds{L}$-elementarily in an $\mathds{L}$-saturated one.
First we prove the following lemma.

\begin{lemma}\label{lem_compattezza}
  Every model ${\EuScript M}$ embeds $\mathds{L}$-elementarily in a model ${\EuScript N}$ that realizes all types as in the definition above.
\end{lemma}

\begin{proof}
  Consider the collection of types such that 1 and 2 above.
  Assume that each type has a distinct variable and let $x$ be the concatenation of all these variables.
  We denote by $p(x)$ the union of all these types.
  Let $I$ be the set of formulas $\xi(x)$ that are satisfied in ${\EuScript M}$.
  For every formula $\varphi(x)$ and every $\varepsilon>0$ define $X_{\varphi,\varepsilon}\subseteq I$ as follows

  \ceq{\hfill X_{\varphi,\varepsilon}}{=}{\Big\{\xi(x)\in I\ :\ \xi(M)\ \subseteq\ {}^{\varepsilon\kern-2pt}\varphi(M)\Big\}}

  Note that ${}^{\varepsilon\kern-2pt}\varphi(x)$ is satisfied in ${\EuScript M}$ if and only if $X_\varphi\neq\varnothing$ if and only if ${}^{\varepsilon\kern-2pt}\varphi(x)\in X_{\varphi,\varepsilon}$.
  Moreover 
  
  \ceq{\hfill X_{\varphi\wedge\psi,\ \min\{\varepsilon,\delta\}}}{\subseteq}{X_{\varphi,\varepsilon}\cap X_{\psi,\delta}.}
  
  Then, as $p(x)$ is finitely consistent, the set 
  
  \ceq{\hfill B}{=}{\big\{X_{\varphi,\varepsilon}\,:\,\varphi(x)\in p\textrm{ and }\varepsilon>0\big\}}
  
  has the finite intersection property.
  Extend $B$ to an ultrafilter $F$ on $I$.
  Let ${\EuScript N}$ be the ultrapower of ${\EuScript M}$ over $F$.
  That is, the model with unit ball $N=M^I$ obtained as in Definition~\ref{def_ultraproduct}.
  By \L\v o\'s Theorem, ${\EuScript M}$ embeds elementariy into ${\EuScript N}$.
  It remains to prove that ${\EuScript N}$ realizes $p(x)$.

  For every formula $\xi(x)\in I$ choose some $a_\xi\in  M^{|x|}$ such that $\xi(a_\xi)$.
  %For legibility we conflate $(M^I)^{|x|}$ with $(M^{|x|})^I$.
  Let $\hat a\in (M^{|x|})^I$ be the function that maps $\xi(x)\mapsto a_\xi$.
  We claim that ${\EuScript N}\models\varphi(\hat a)$ for every $\varphi(x)\in p$.
  By Fact~\ref{fact_immediate}, it suffices to prove that ${\EuScript N}\models{}^{\varepsilon\kern-2pt}\varphi(\hat a)$ for every $\varepsilon>0$.
  Suppose not, then by \L\v o\'s Theorem (Proposition~\ref{thm_Los} with $\varepsilon$ for $\lambda$), for some $\varepsilon'>0$ the set 

  \ceq{\hfill Y_{\varphi,\varepsilon+\varepsilon'}}{=}{\Big\{\xi(x)\in I\ :\ {\EuScript M}\not\models{}^{\varepsilon+\varepsilon'\kern-2pt}\varphi(a_\xi)\Big\}}

  belongs to $F$.
  This is a contradiction because $B\subseteq F$ contains the set $X_{\varphi,\varepsilon+\varepsilon'}\subseteq Y_{\varphi,\varepsilon+\varepsilon'}$. 
\end{proof}

\begin{corollary}\label{thm_compattezza}
  Every model ${\EuScript M}$ is an $\mathds{L}$-elementary subtructure of some saturated model ${\EuScript N}$ (possibly of inaccessible cardinality).
\end{corollary}

We denote by \emph{${\EuScript U}$\/} some large $\mathds{L}$-saturated structure which we call the \emph{monster model.}
The unit ball of ${\EuScript U}$ is denoted by \emph{$U$.}
The cardinality of ${\EuScript U}$ is an inaccessible cardinal that we denote by \emph{$\kappa$.}
Below we say \emph{model\/} for $\mathds{L}$-elementariy substructure of ${\EuScript U}$.


\begin{lemma}\label{lem_compactness_implication}
  Let $p(x)\subseteq\mathds{L}(A)$, where $A\subseteq U$ has small cardinality.
  Let $\varphi(x)\in\mathds{L}(U)$ be such that $p(x)\rightarrow\varphi(x)$.
  Then for every $\varepsilon>0$ there is a formula $\psi(x)$, conjunction of formulas in $p(x)$, such that $\psi(x)\rightarrow\neg{}^{\neg\varepsilon\kern-2pt}\varphi(x)$.
\end{lemma}

\begin{proof}
  Let $\varepsilon>0$ be given.
  Suppose that $\psi(x)\wedge{}^{\neg\varepsilon\kern-2pt}\varphi(x)$ is consistent for every $\psi(x)$ that is conjunction of formulas in $p(x)$.
  By saturation there is a realization of $p(x)\cup{}^{\neg\varepsilon\kern-2pt}\varphi(x)$.
  By Fact~\ref{fact_immediate}, $p(x)\wedge\neg\varphi(x)$ is also consistent.
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%
\section{Complete models}

\def\ceq#1#2#3{\parbox[t]{25ex}{$\displaystyle #1$}\parbox{5ex}{\hfil $#2$}{$\displaystyle #3$}}

Let ${\EuScript M}$ be a model.
Let $a\in U^{|x|}$.
We say that ${\EuScript M}$ \emph{defines $a$ in the limit\/} if 

\ceq{\hfill p_{\restriction M}(x)}{\rightarrow}{p(x):={\rm tp}_\mathds{L}(a/U)}

or, in other words, if $a'\equiv^\mathds{L}_Ma$ implies $a'\sim_{\EuScript U}a$.

Note that the definability of a tuple in the limit is equivalent to the definability of its components.
This follows from the following obvious identity

\ceq{\hfill {\rm tp}_\mathds{L}(a,b/U)}
{=}
{{\rm tp}_\mathds{L}(a/U)\ \cup\ {\rm tp}_\mathds{L}(b/U).}

Now we characterize definability in the limit in topological terms.


\begin{definition}
  A model ${\EuScript M}$ is complete if it contains, up to $(\sim_{\EuScript U})$-equivalence, all points it defines in the limit.
\end{definition}

Let \emph{$\bar M$\/} be the set points that are defined in the limit by ${\EuScript M}$.
We denote by \emph{$\bar{\EuScript M}$\/} the (unique) substructure of ${\EuScript U}$ with unit ball $\bar M$.
We call  $\bar{\EuScript M}$ the \emph{completion\/} of ${\EuScript M}$.

We say that a model ${\EuScript N}$ is $M$-$\mathds{L}$-saturated if it realizes all constistent types $p(x)\subseteq\mathds{L}(M)$.
The following proposition is easy to prove.

\begin{proposition}
  $\bar{\EuScript M}$ is the intersection of all $M$-$\mathds{L}$-saturated models.
\end{proposition}

\begin{proposition}
  $\bar{\EuScript M}$ is complete.
\end{proposition}

\begin{proof}
  Suppose $a\in U$ is defined in the limit by $\bar{\EuScript M}$, that is

  \ceq{\hfill p'(x,b)}{\rightarrow}{p(x):={\rm tp}_\mathds{L}(a/U)}
  
  for some $b\in\bar M^{|z|}$ and $p'(x,z)\subseteq\mathds{L}(M)$ such that $p_{\restriction\bar M}(x)=p'(x,b)$.  
  Let $q(z)={\rm tp}_\mathds{L}(b/U)$, then

  \ceq{\hfill q_{\restriction M}(z)\ \cup\ p'(x,z)}{\rightarrow}{p(x)}
  
  Finally, $a\in\bar M$ follows because

  \ceq{\hfill p_{\restriction M}(x)}{\rightarrow}{\exists z\ \big[q_{\restriction M}(z)\ \cup\ p'(x,z)\big].}
\end{proof}

\begin{question}
  $\bar{\EuScript M}\preceq_\mathds{L}{\EuScript U}$ \ ?
\end{question}
% %%%%%%%%%%%%%%%%%%%%%%%
% %%%%%%%%%%%%%%%%%%%%%%%
% %%%%%%%%%%%%%%%%%%%%%%%
% %%%%%%%%%%%%%%%%%%%%%%%


% Let ${\EuScript M}$ be a substructure of ${\EuScript U}$.
% Let $a\in U^{|x|}$.
% We say that ${\EuScript M}$ \emph{defines $a$ in the limit\/} if there is a formula $\varphi(x)\in\mathds{L}(M)$ and some infinite sets $B_1,\dots,B_n\subseteq M$ such that

% \ceq{\hfill\big\{\varphi(x)\big\}\ \cup\ p_{\restriction C}(x)}{\rightarrow}{p(x):={\rm tp}_\mathds{L}(a/U)}

% for every $C$ that has infinite intersection with all $B_1,\dots,B_n$.



% The following proposition is an immediate consequence of the definition of the relation $(\sim_{\EuScript U})$ in Section~\ref{L-relations}.

% \begin{proposition}
%   Suppose that $a'\equiv^\mathds{L}_Ma$ are both defined in the limit by ${\EuScript M}$.
%   Then $a'\sim_{\EuScript U}a$.
% \end{proposition}

% Finally we define completeness as a weak form of saturation.
% It is easy to verify that if ${\EuScript M}$ is the metric space in Example~\ref{ex_metric}, then the completeness of ${\EuScript M}$ is equivalent to the Cauchy-completeness of $(M,{\rm d})$.

% The proof of the following proposition is tedious but straightforward.

% \begin{proposition}
%   $\bar{\EuScript M}$ is complete.
% \end{proposition}

% \begin{proof}
%   Let $a\in U$ be defined in the limit by $\bar{\EuScript M}$.
%   For some formula $\varphi(x)\in\mathds{L}(\bar M)$ and some infinite set $B\subseteq\bar M$ we have that for every infinite $C\subseteq B$

%   \ceq{\hfill\big\{\varphi(x)\big\}\ \cup\ p_{\restriction C}(x)}{\rightarrow}{p(x):={\rm tp}_\mathds{L}(a/U)}

%   Let $b$ be a tuple that enumerates $B$ and the parameters of  $\varphi(x)$.
%   We rewrite the condition above with the dependence from $b$ displaied

%   \ceq{\hfill\big\{\varphi(x,b)\big\}\ \cup\ p_{\restriction C}(x,b)}{\rightarrow}{p(x,b).}

%   where $p(x,z)={\rm tp}_\mathds{L}(a,b/U)$.
%   As $b$ is defined in the limit by ${\EuScript M}$, there is a 

%   \ceq{\hfill\big\{\psi(z)\big\}\ \cup\ q_{\restriction C}(z)}{\rightarrow}{q(z)={\rm tp}_\mathds{L}(b/U)}
% \end{proof}

% Without additional hypothesis we cannot guarantee that $\bar{\EuScript M}$ is a model.

% \begin{theorem}
%   $\bar{\EuScript M}$ is an existentially closed substructure of ${\EuScript U}$.
% \end{theorem}

% \begin{proposition}
%   $\bar{\EuScript M}\preceq^\mathds{L}{\EuScript U}$.
% \end{proposition}

% \begin{proof}
%   Apply the Tarski-Vaught Test~\ref{prop_Tarski-Vaught}.
%   Let $\psi(x,z)\in\mathds{L}$ and $a\in\bar M^{|z|}$ be such that $\psi(x,a)$ is consistent.
% Let $p(z)={\rm tp}_\mathds{L}(a/U)$.
% For some $B\subseteq M$ and some formula $\varphi(z)\in\mathds{L}(M)$ 

%   \ceq{\hfill\big\{\varphi(z)\big\}\ \cup\ p_{\restriction C}(z)}{\rightarrow}{\exists x\ \psi(x, z)}
% \end{proof}



%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Homogeneity}
Recall that $\kappa$,  the cardinality of ${\EuScript U}$, is an inaccessible cardinal.

\begin{fact}
  Let $R\subseteq{\EuScript U}^2$ be an $\mathds{L}$-relation of cardinality $<\kappa$.
  Then there is a total and surjective $\mathds{L}$-relation $S\subseteq{\EuScript U}^2$ containing $R$.
\end{fact}

\begin{proof}
  We apply the usual back-and-forth construction with a pinch of extra caution.
  Let $a$ be an enumeration of the domain of $R$.
  Let $\bar a=\langle a_i:i<\lambda\rangle$ be an enumeration of all tuples of length $|a|$ such that $aRa_i$.
  As $\kappa$ is inaccessible, $\lambda<\kappa$.
  Let $b\in U$.
  It suffices to prove that there is a $c$ such that $R\cup\{\langle b,c\rangle\}$ is an $\mathds{L}$-relation.
  Let $p(x,z)={\rm tp}(b,a)$ and let
  
  \ceq{\hfill q(x,\bar z)}{=}{\bigcup_{i<\lambda}p(x,z_i).}

  We claim that $q(x,\bar a)$ is a finitely consistent type.
  A finite conjunction of formulas in $q(x,\bar a)$ has the form $\psi(x,a_{i_1})\wedge\dots\wedge\psi(x,a_{i_n})$.
  As $\psi(b,a)$ and $a_{i_1},\dots,a_{i_n}\,R\;a,\dots,a$, we conclude that the condition $\psi(x,a_{i_1})\wedge\dots\wedge\psi(x,a_{i_n})$ is satisfied.
  The existence of the required element $c$ follows by saturation.
\end{proof}

\begin{corollary}
  Let $A\subseteq{\EuScript U}$ have cardinality $<\kappa$.
  Let $p(x)={\rm tp}_\mathds{L}(a/A)$, where $a\in{\EuScript U}^{|x|}$ is a tuple of length $|x|<\kappa$.
  Then

  \ceq{\hfill p({\EuScript U})}{=}{\big\{b : bRa,\ R\in{\rm Aut}({\EuScript U}/A)\big\}}
\end{corollary}


% The following corollary of \L\v{o}\'s Theorem is identical to its classical counterpart.

% \begin{corollary}
%   For every model ${\EuScript M}$ and every ultrafilter $F$ on $I$, an infinite set, let ${\EuScript N}$ be corresponding ultrapower of ${\EuScript M}$.
%   Then there is an $\mathds{L}$-elementary embedding of ${\EuScript M}$ in ${\EuScript N}$.\qed
% \end{corollary}

% Note also that, unlike the classical ultraproduct, here we do not quotient the structure obtained in Definition~\ref{def_ultraproduct}.
% However, we note the following fact which is an easy consequence of \L\v o\'s Theorem.

% \begin{fact}
%   Let $R\subseteq N^2$ be the set of those pairs $(\hat a, \hat b)$ such that $\{i\in I:\hat ai=\hat bi\}\in F$.
%   Then $R$ is an $\mathds{L}$-relation.\qed
% \end{fact}

\end{document}


%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
\section{Examples}

\def\ceq#1#2#3{\parbox[t]{25ex}{$\displaystyle #1$}\parbox{5ex}{\hfil $#2$}{$\displaystyle #3$}}

\begin{itemize}
  \item [1.] Firstly, we leave to the reader to check that classical first-order models are a (trivial) special cases of the models introduced above.
        Classical relations take values in $\{0,1\}$ where $0$ is interpreted as ``true''.
        The unit ball is the whole of ${\EuScript M}$.
        The function $n_{\mbox-}$ is constantly $1$.
        To obtain the full strength of first-order logic one has to add equality as a predicate as it is absent from our logic.

  \item [2.] Secondly, any {\sc bbhu}-premodel is also a model as those in Section~\ref{uno} if we let the unit ball coincide with ${\EuScript M}$.
        The language $L$ contains a relation symbol $d(x,y)$ for a metric and, possibly, symbols for all other functions and relations of ${\EuScript M}$.
        As all relations of ${\EuScript M}$ (including the metric) take values in the interval $[0,1]$, the function $n_{\mbox-}$ can be set to be the constant $1$.

  \item [3.] \breve Now we consider an example that is non trivial and distant both from classical models and from {\sc bbhu}-models: weighted graphs.
        The set $L_{\rm fun}$ is empty and $L_{\rm rel}$ contains only a binary relation $r$.
        We require that $r^{\EuScript M}(a,b)=r^{\EuScript M}(b,a)\in[0,1]$.
        As unit ball take, again,the whole of ${\EuScript M}$.
        The function $n_{\mbox-}$ is constant $1$.


  \item [4.] Finally, and example where the unit ball is non trivial.
        Let $L$ be the language of Banach spaces.
        Here we have only one symbol in $L_{\rm rel}$, the symbol $\|\mbox-\|$ for the norm.
        The set $L_{\rm fun}$ is the same as for real vector spaces in classical logic.
        Let ${\EuScript M}$ be a Banach space and define a uniformly continuous model as follows.
        The interpretation of the symbols in $L_{\rm rel}\cup L_{\rm fun}$ is the natural one.
        The unit ball of is $ M=\{a\in  M: \|a\|\le1\}$.
        

        % Let $\varphi(x)$ be an atomic formula.
        % This has form $\|t(x)\|$ for some $t(x)\in L_{\rm trm}$.  
        % Note that $\sup\{\|t(a)\|: a\in U^{|x|}\}$ does not depend on $ M$.
        % Therefore we can set it to be $n_{\varphi(x)}$

\end{itemize}

%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
\section{Conditions and types}

For $\varphi, \psi\in L( M)$ some closed formulas, we write \emph{${\EuScript M}\models\ \varphi\le\psi$} for $\varphi^{\EuScript M}\le\psi^{\EuScript M}$.
The meaning of \emph{${\EuScript M}\models\ \varphi=\psi$\/} and of \emph{${\EuScript M}\,\models\ \varphi<\psi$\/} is similar.

Expressions of the form $\varphi(x)\le0$ are called \emph{conditions}.
We write ${\EuScript M}\models\exists x\,\varphi(x)\le0$ if there is an $a\in  M^{|x|}$ such that ${\EuScript M}\models\varphi(a)\le0$.
Observe that $\varphi(x)=0$ is equivalent to $|\varphi(x)|\le0$ and that $\varphi(x)\le0$ is equivalent to $\big(\varphi(x)\vee0\big)=0$.
So, when convenient, we may use equalities to denote conditions.

The negation of a condition is called a \emph{co-conditions}.
So, $\varphi(x)\neq0$, $\varphi(x)<0$ or $\varphi(x)>0$ are co-conditions.

It is easy to see that conditions are cosed under logical disjunction and logical conjunction.

\ceq{\hfill {\EuScript M}\models\varphi\vee\psi\le0}
{\Leftrightarrow}
{{\EuScript M}\models\varphi\le0 \textrm{ and }{\EuScript M}\models\psi\le0}

\ceq{\hfill {\EuScript M}\models\varphi\wedge\psi\le0}{\Leftrightarrow}{{\EuScript M}\models\varphi\le0 \textrm{ \ or \ }{\EuScript M}\models\psi\le0}

Condition are also closed under universal quanfication (over the unit ball).

\ceq{\hfill {\EuScript M}\models\bigvee_x\varphi(x)\le0}{\Leftrightarrow}{{\EuScript M}\models\forall x\ \varphi(x)\le0}

Closure under existential quanfication is a more subtle point.
It is not true in general but it can be ensured by a small amount of saturation (cf.~Fact~\ref{fact_existential}).

A set of conditions is called a \emph{type\/} or, when $x$ is the empty tuple, a \emph{theory.}
For $p(x)\subseteq L( M)$, we define

\hfil\emph{$p(x)\le0$}\ \ =\ \ $\big\{\varphi(x)\le0 \ \  :\ \  \varphi(x)\in p\big\}.$

Up to equivalence, all types have the form above.

Beware that $p(x)$ denotes just a set of formulas, the expression $p(x)\le0$ denotes a type.

We write \emph{${\EuScript M}\models p(a)\le0$} if ${\EuScript M}\models\varphi(a)\le0$ for every $\varphi(x)\in p$.
We write \emph{${\EuScript M}\models \exists x\ p(x)\le0$} if ${\EuScript M}\models p(a)\le0$ for some $a\in  M^{|x|}$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Saturation}\label{saturation}

\def\ceq#1#2#3{\parbox[t]{20ex}{$\displaystyle #1$}\parbox{5ex}{\hfil $#2$}{$\displaystyle #3$}}

From this section on, we assume the existence of unboundedly many inaccessible cardinals as this simplifies the exposition.
We prove directly the existence of saturated extension (monster models), skipping the proof of the compactness theorem as this is not required in the following.
(The compactness theorem could be proved along the same lines.)

Let $p(x)\subseteq L( M)$.
We say that $p(x)\le 0$ is \emph{finitely satisfied in ${\EuScript M}$\/} if for every disjunction of formulas in $p(x)$, say $\psi(x)$, there is an $a\in  M^{|x|}$ such that ${\EuScript M}\models\psi(a)\le0$.

\begin{definition}
  We say that ${\EuScript M}$ is \emph{saturated\/} if for every $p(x)$ as in 1 and 2 below, there is an $a\in  M^{|x|}$ such that ${\EuScript M}\models p(a)\le0$
  \begin{itemize}
    \item[1.] $p(x)\subseteq L(A)$ for some $A\subseteq  M$ of cardinality $<| M|$ and $|x|=1$;
    \item[2.] $p(x)\le0$ is finitely satisfied in $ M$.
  \end{itemize}
\end{definition}

From \L\v{o}\'s Theorem we obtain that every model embeds $\mathds{L}$-elementarily in a saturated one.
First we prove the following lemma.

\begin{lemma}\label{thm_compattezza}
  Every model ${\EuScript M}$ embeds $\mathds{L}$-elementarily in a model ${\EuScript N}$ that realizes all types as in 1 and 2.
\end{lemma}

\begin{proof}
  Consider the collection of types such that 1 and 2 above.
  Assume that each type has its own set of variables and let $x$ be the concatenation of all these variables.
  We denote by $p(x)$ the union of all these types.
  Let $I$ be the set of formulas $\xi(x)$ such that $\xi(x)\le0$ is satisfied in $ M$.
  For every condition $\varphi(x)\le0$ define $X_\varphi\subseteq I$ as follows

  \ceq{\hfill X_\varphi}{=}{\Big\{\xi(x)\in I\ :\ \xi( M)\le0\ \subseteq\ \varphi( M)\le0\Big\}}

  Note that $\varphi(x)\le0$ is consistent if and only if $X_\varphi\neq\varnothing$ if and only if $\varphi(x)\in X_{\varphi}$.
  \breve Moreover $X_{\varphi\vee\psi}\ =\ X_\varphi\cap X_\psi$. Then, as $p(x)$  is finitely consistent, the set $B=\big\{X_\varphi\,:\,\varphi(x)\in p\big\}$ has the finite intersection property.
  Extend $B$ to an ultrafilter $F$ on $I$.
  Let ${\EuScript N}$ be the ultrapower of ${\EuScript M}$ over $F$.
  That is the model with unit ball $\breve N= M^I$ obtained as in Definition~\ref{def_ultraproduct}.

  For every formula $\xi(x)\in I$ choose some $a_\xi\in  M^{|x|}$ such that $\xi(a_\xi)\le0$.
  We may confuse $( M^I)^{|x|}$ with $( M^{|x|})^I$ as it simplifies notation.
  Let $\hat a\in ( M^{|x|})^I$ be the function that maps $\xi(x)\mapsto a_\xi$.
  By \L\v o\'s Theorem, for every formula $\varphi(x)$

  \ceq{\hfill \varphi^{\EuScript N}\big(\hat a\big)}{=}{\lim_{\xi\to F}\varphi^{ M}\big(a_\xi\big).}

  Therefore $\hat a$ realizes $p(x)\le0$ in ${\EuScript N}$.
\end{proof}

\begin{theorem}
  Every model ${\EuScript M}$ embeds $\mathds{L}$-elementarily in a saturated model.
\end{theorem}

\begin{proof}
  As usual, iterate the lemma to construct a chain of length $\lambda$, a sufficiently large inaccessible cardinal.
\end{proof}

We conclude with a convenient property of saturated models.

\begin{fact}\label{fact_existential}
  Let $ M$ is saturated.
  Then for every $\varphi(x)\in L( M)$ the following are equivalent
  \begin{itemize}
    \item[1.] $ M\models\exists x\ \big(\varphi(x)\le0\big)$;
    \item[2.] \smash{$ M\models\displaystyle \bigwedge_x \varphi(x)\;\le\;0$}
  \end{itemize}
\end{fact}
\begin{proof}
  Only 2$\Rightarrow$1 requires a proof.
  Let $p(x)=\{\varphi(x)-\alpha: \alpha\in{\mathds R}^+\}$.
  If 2, then $p(x)\le0$ is finitely satisfied in $ M$.
  Hence 1 follows by saturation.
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Homogeneity}

Throughout the following we fix a saturated model \emph{$\EuScript U$\/} of cardinality $\kappa$, an inaccessible cardinal larger than $|L|$, where $|L|$ stands for $\max\big\{|L_{\rm fun}|,|L_{\rm rel}|,2^\omega\big\}$.

Let $a\in{\EuScript U}^{|x|}$.
We write $p(x)={\rm tp}(a/A)$ for $p(x)=\big\{\psi(x)\in L(A):{\EuScript U}\models \psi(a)\le0\big\}$.
We write ${\rm tp}(a)$ when $A=\varnothing$.

\begin{fact}
  Let $R\subseteq{\EuScript U}^2$ be an $\mathds{L}$-relation of cardinality $<\kappa$.
  Then there is a total and surjective $\mathds{L}$-relation $S\subseteq{\EuScript U}^2$ containing $R$.
\end{fact}

\begin{proof}
  We apply the usual back-and-forth construction with a pinch of extra caution.
  Below we will make free use of Fact~\ref{fact_existential}.
  Let $a$ be an enumeration of the domain of $R$.
  Let $\bar a=\langle a_i:i<\lambda\rangle$ be an enumeration of all tuples of length $|a|$ such that $aRa_i$.
  As $\kappa$ is inaccessible, $\lambda<\kappa$.
  Let $b\in{\EuScript U}$.
  It suffices to prove that there is a $c$ such that $R\cup\{\langle b,c\rangle\}$ is an $\mathds{L}$-relation.
  Let $p(x,z)={\rm tp}(b,a/A)$ and let
  
  \ceq{\hfill q(x,\bar z)}{=}{\bigcup_{i<\lambda}p(x,z_i).}

  We claim that $q(x,\bar a)\le0$ is finitely consistent.
  A finite conjunction of formulas in $q(x,\bar a)$ has the form $\psi(x,a_{i_1})\wedge\dots\wedge\psi(x,a_{i_n})$.
  As $\psi(b,a)\le0$ and $a_{i_1},\dots,a_{i_n}\,R\;a,\dots,a$, we conclude that the condition $\psi(x,a_{i_1})\wedge\dots\wedge\psi(x,a_{i_n})\le0$ is satisfied.
  The existence of the required element $c$ follows from saturation.
\end{proof}

\begin{corollary}
  Let $a\in{\EuScript U}^{|x|}$, where $|x|<\kappa$.
  Let $A\subseteq{\EuScript U}$ have cardinality $<\kappa$.
  Then

  \ceq{\hfill p({\EuScript U})\le0}{=}{\big\{b : bRa,\ R\in{\rm Aut}({\EuScript U}/A)\big\}}
\end{corollary}


\hrulefill

Di qui in poi solo esperimenti selvaggi.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Random variables}

Let ${\EuScript A}$ be a $\sigma$-algebra of subsets of $\Omega$.
Let ${\EuScript M}$ be the set of bounded $\sigma$-additive measures on ${\EuScript A}$.
Let ${\EuScript R}$ be the set of functions $f:\Omega\to{\mathds R}$ that are measurable w.r.t.\@ all measures in ${\EuScript M}$.

We define a $3$-sorted structure $\langle{\EuScript A},{}^{\circ\!}{\EuScript R},{}^{\circ\!}{\EuScript M}\rangle$.

The domain of the first sort is ${\EuScript A}$.
The language contains functions for the Boolean operations.

% On $\Omega$ we define the equivalence relation $\sim_{\EuScript A}$ as follows: $a\sim_{\EuScript A} b$ if $a\in A\leftrightarrow b\in A$ for every $A\in{\EuScript A}$.
% We make use of $\Omega$ and  $\sim_{\EuScript A}$ in the definitions of $\langle{\EuScript A},{}^{\circ\!}{\EuScript R},{}^{\circ\!}{\EuScript M}\rangle$ but they will not directly appear in the structure.

% We now define ${}^{\circ\!}{\EuScript R}$ and ${}^{\circ\!}{\EuScript M}$.
% We warn the reader that, at a deeper level these two domain contains the same elements, the difference being only in the syntax.

The domain of the second sort ${}^{\circ\!}{\EuScript R}$ contains the functions $f\in{\mathds R}$ that are linear combinations of indicator functions of sets in ${\EuScript A}$.
In the language we include the functions that make ${}^{\circ\!}{\EuScript R}$ an ${\mathds R}$-algebra (sum and and multiplications are defined pointwise).
We also include operations for the pointwise maximum and minimum of two functions.
% The unit ball, $S$, contains functions that are $\le1$ in absolute value.

The domain of the third sort, ${}^{\circ\!}{\EuScript M}$, contains signed measures $\mu:{\EuScript A}\to{\mathds R}$ that are linear combinations of measures of the form $\delta_a$, for $a\in\Omega$.
These are defined as follows: $\delta_a(A)$ is $1$ if $a\in A$ and $0$ otherwise.
The language is that of lattice vector spaces.
% The unit ball, $ M$, contains the measures in ${}^{\circ\!}{\EuScript M}$ that are $\le1$ in absolute value.

There is a function of sort ${}^{\circ\!}{\EuScript R}\times{}^{\circ\!}{\EuScript M}\to{}^{\circ\!}{\EuScript M}$ that maps $(f,\mu)$ to the measure $f\mu$ obtained multiplying in the natural way $f$ and $\mu$.

Finally, there is a predicate $I$ of sort ${\EuScript A}\times{}^{\circ\!}{\EuScript M}$ such that $I(A,\mu)=\mu(A)$.

The unit ball of $\langle{\EuScript A},{}^{\circ\!}{\EuScript R},{}^{\circ\!}{\EuScript M}\rangle$ is $\langle{\EuScript A},{}^{\circ\!\!}R, M\rangle$ where ${}^{\circ\!\!}R$ and ${}^{\circ\!\!} M$ are the set of functions, respectively measures, that are $\le1$ in absolute value.

The readers can easily convince themselfs that a bounding function exist.
Its explicit definition is not required in the sequel.

\hfil ***

The following discrete version of the Radon-\breve Nikodym theorem is completely trivial.
For simplicity we state it for (nonnegative) measures.
As the Hahn decomposition theorem holds (trivially) in ${}^{\circ\!}{\EuScript M}$, this is no loss of generality.

\begin{fact}\label{thm_fR\breve N}
  [Discrete Radon-\breve Nikodym]
  Let $\mu,\nu\in{}^{\circ\!\!} M$, where ${}^{\circ\!\!} M$ is the unit ball of ${}^{\circ\!}{\EuScript M}$, be non negative.
  For every $\varepsilon > 0$ there are $E\in{\EuScript A}$ and $f\in {}^{\circ\!\!}R$, where ${}^{\circ\!\!}R$ is the unit ball of ${}^{\circ\!}{\EuScript R}$, such that
  \begin{itemize}
    \item[1.] $I(E,|\nu-\varepsilon^{-1}f\mu|)\ =\ 0$
    \item[2.] $|I(\neg E, \mu)|\le\varepsilon$.
  \end{itemize}
\end{fact}

We will use the following version of the fact above.

% \begin{fact}\label{thm_fR\breve N2}
%   [Iterated discrete Radon-\breve Nikodym]
%   Let $\mu,\nu\in{}^{\circ\!\!} M$, where ${}^{\circ\!\!} M$ is the unit ball of ${}^{\circ\!}{\EuScript M}$.
%   For every $n>0$ there are $E_1,\dots,E_n\in{\EuScript A}$ and $f\in{}^{\circ\!\!}R$, such that
%   \begin{itemize}
%     \item[0.] $E_n\subseteq E_{n-1}\subseteq {\dots\dots} \subseteq E_1\subseteq E_0=\Omega$
%     \item[1.] $I\big(E_i\smallsetminus E_{i+1},\ |\nu-2^{-(i+1)}f\mu|\big)\ =\ 0$
%     \item[2.] $|I(E_{i+1},\ \mu)|\le2^{-(i+1)}$;
%     \item[3.] $f_{i+1}\big[E_i\smallsetminus E_{i+1}\big]=\{0\}$.
%   \end{itemize}
% \end{fact}

% \begin{proof}
%   Apply inductively the theorem above, with $E_i$ for $\Omega$, to find $E_{i+1}$ and $f_{i+1}$ such that
%   \begin{itemize}
%     \item[1$_i$.] $I\big(E_i\smallsetminus E_{i+1},\ |\nu-2^{-(i+1)}f_{i+1}\mu|\big)\ =\ 0$;
%     \item[2$_i$.] $|I(E_{i+1},\ \mu)|\le2^{-(i+1)}$;
%     \item[3$_i$.] $f_{i+1}\big[E_i\smallsetminus E_{i+1}\big]=\{0\}$.
%   \end{itemize}
%   Finally, let $f=f_1+\dots+f_n$.
% \end{proof}


\begin{fact}\label{thm_fR\breve N2}
  [Iterated discrete Radon-\breve Nikodym]
  Let $\mu,\nu\in{}^{\circ\!\!} M$ be non negative.
  For every $n>0$ there are $E_1,\dots,E_n\in{\EuScript A}$ and $f\in{}^{\circ\!\!}R$ such that
  \begin{itemize}
    \item[0.] the $E_i$ are pairwise disjoint;
    \item[1.] $I\big(E_i,\ |\nu-2^if\mu|\big)\ =\ 0$
    \item[2.] $|I(X,\ \mu)|\le2^{-i}$, where $X=\neg(E_1\cup\dots\cup E_i)$;
  \end{itemize}
\end{fact}


\begin{proof}
  Apply inductively the theorem above, with $E_i$ for $\Omega$, to find $E_{i+1}$ and $f_{i+1}$ such that
  \begin{itemize}
    \item[1$_i$.] $I\big(E_i,\ |\nu-2^if_i\mu|\big)\ =\ 0$;
    \item[2$_i$.] $|I(X,\ \mu)|\le2^{-i}$, where $X=\neg(E_1\cup\dots\cup E_i)$;
    \item[3$_i$.] $f_i\big[\neg E_i]=\{0\}$.
  \end{itemize}
  Finally, let $f=f_1+\dots+f_n$.
  The third condition above (which is immediate to obtain) ensures that $f\in{}^{\circ\!\!}R$.
\end{proof}

% Write $\nu\ll\mu$ if for every $\varepsilon>0$ there is a $\delta>0$ such that $I(X,\mu)\le\delta\Rightarrow I(X,\nu)\le\varepsilon$ for all $X\in$.


% \begin{corollary}\label{cor_fR\breve N}
%   Let $\mu,\nu\in{}^{\circ\!\!} M$ be such that $\nu\ll\mu$.
%   For every $\varepsilon > 0$ there exist an exceptional set $E\in{\EuScript A}$ and an $f\in S$, the unit ball of ${}^{\circ\!}{\EuScript R}$, such that
%   \begin{itemize}
%     \item[1.] $I(X,1,\nu)\ =\ I(X,f/\varepsilon,\mu)$ for evey $X\subseteq\neg E$;
%     \item[2.] $\displaystyle\sup_{X\subseteq E}|I(X, \mu)|\le\varepsilon$.
%   \end{itemize}
% \end{corollary}

% We note that 1 \& 2 of Theorem~\ref{thm_fR\breve N} can be expressed by a condition.
% Infact, if $\varphi(X)$ is a formula, where $X$ is a variable of sort ${\EuScript A}$, then $\sup_{Y\subseteq X}\varphi(Y)$ is a formula --~as it is equivalent to $\sup_Y\varphi(Y\cap X)$.
% Also, recall that conditions are closed under the Boolean operations of conjunction and disjunction.
% They are also closed under universal quantification.

We now consider a saturated extension of $\langle{\EuScript A},{}^{\circ\!}{\EuScript R},{}^{\circ\!}{\EuScript M}\rangle$ that we denote by $\langle{}^{*\!\!\!}{\EuScript A},{}^{*\!}{\EuScript R},{}^{*\!}{\EuScript M}\rangle$.
The following fact is a direct consequence of saturation.

\begin{fact}
  Let $\mu\in{\EuScript M}$.
  Then there is ${}^{*\!\!}\mu\in{}^{*\!}{\EuScript M}$ such that $\mu_{\restriction{\EuScript A}}={}^{*\!\!}\mu_{\restriction{\EuScript A}}$.
\end{fact}

\begin{proof}
  It suffices to check that the following type is finitely consistent in ${\EuScript A}$ (read $\nu$ as a variable and $\mu(X)$ as a real number)
  $$
  \big\{\nu(X)=\mu(X) \ :\ X\in{\EuScript A}\big\},
  $$
  which immediate.
\end{proof}

We can improve on the fact above.
In fact, we can also control the value of ${}^{*\!\!}\mu(A)$ for any $A\in{\EuScript A}$.

\def\ceq#1#2#3{\parbox[t]{25ex}{$\displaystyle #1$}\parbox{5ex}{\hfil $#2$}{$\displaystyle #3$}}

\begin{fact}
  Let $\mu$ be a bounded measure on ${\EuScript A}$, not necessarily in ${}^{\circ\!}{\EuScript M}$.
  Let $A\in{}^{*\!\!\!}{\EuScript A}$.
  Define 
  
  \ceq{\hfill m_{\rm in\,}}{=}{\sup\{\mu(X): X\in{\EuScript A},\ X\subseteq A\}}

  \ceq{\hfill m_{\rm ex}}{=}{\,\inf\{\mu(X): X\in{\EuScript A}, \  A\subseteq X \}}

  Then for every $m_{\rm in\,}\le r\le m_{\rm ex}$ there is a measure ${}^{*\!\!}\mu\in{}^{*\!}{\EuScript M}$ such that ${}^{*\!\!}\mu_{\restriction{\EuScript A}}=\mu_{\restriction{\EuScript A}}$ and  ${}^{*\!\!}\mu(A)=r$.
\end{fact}

\begin{proof}[Proof (sketch)]
Assume for simplicity that $\mu$ is bounded by $1$.
It suffices to check that the following type is finitely consistent (read $\nu$ as a variable and $\mu(X)$ as a real number).
$$
\big\{\nu(X)=\mu(X) \ :\ X\in{\EuScript A}\big\}
\ \ \cup\ \ \
\big\{\nu(A)=r\big\}.
$$
In fact, any ${}^{*\!\!}\mu$ realizing this type is as required by the lemma.

Let ${\EuScript A}'\subseteq{\EuScript A}$ be a finite Boolean algebra.
We define a measure $\nu$ on the Boolean algebra generated by $A,X_1,\dots,X_n$ that satisfies the type above restrected to ${\EuScript A}'\cup\{A\}$.
Let $X_1,\dots,X_n$ be the atoms of ${\EuScript A}'$.
Assume $A\notin{\EuScript A}$, to avoid trivialities.
Then there are some sets $X_i$ such that both $X_i\cap A$ and $X_i\smallsetminus A$ are nonempty.
Suppose these sets are $X_1,\dots,X_m$.
For $i\le m$ we define $\nu(X_i\cap A)=\varepsilon\,\mu(X)$ and $\nu(X_i\smallsetminus A)=(1-\varepsilon)\mu(X_i)$, where $0\le\varepsilon\le1$ is specified below.
For $i>m$ let $\nu(X_i)=\mu(X_i)$.
Note that $\mu(X_1\cup\dots\cup X_m)\ge m_{\rm ex}-m_{\rm in}$.
Therefore with a suitable $\varepsilon$, we can obtain $\nu(A)=r$.
\end{proof}

If ${\EuScript A}$ is a $\sigma$-algebra and $\mu$ is a $\sigma$-additive measure then the supremum and the infimum in the fact above are attained.
We will use the following.

\begin{corollary}
  Let $\mu\in{\EuScript M}$.
  Then for every $A\in{}^{*\!\!\!}{\EuScript A}$ there are $A_{\rm in},A_{\rm ex}\in{\EuScript A}$ such that $A_{\rm in}\subseteq A\subseteq A_{\rm ex}$ and a measures ${}^{*\!\!}\mu$ such that 
  ${}^{*\!\!}\mu_{\restriction{\EuScript A}}=\mu_{\restriction{\EuScript A}}$ and ${}^{*\!\!}\mu(A)=\mu(A_{\rm ex})$.  
  A similar claim holds for $A_{\rm in}$.
  %We can also require it holds simultaneously for any family of sets $\{A_i:i<\lambda\}\subseteq{}^{*\!\!\!}{\EuScript A}$ of small cardinality (???).
\end{corollary}
\end{document}

\begin{question}
  Let $\mu\in{\EuScript M}$.
  Let ${}^{*\!\!}\mu\in{}^{*\!}{\EuScript M}$ be as above.
  Let $f\in{}^{*\!\!}R$, the unit ball of ${}^{*\!}{\EuScript R}$, be given and assume $f$ is non negative.
  We define the function ${}^{\mu\!\!}f:\Omega\to{\mathds R}$ as follows (tentative)
  $$
  {}^{\mu\!\!}f(a)\ =\ \inf\big\{\alpha : I(A, f\,{}^{*\!\!}\mu)\le \alpha \mu(A) \ :\ A\in{\EuScript A},\ a\in A\big\}
  $$
  Is it true that for every $A\in{\EuScript A}$ 
  $$
  \int_A{}^{\mu\!\!}f{\rm d}\mu\ =\ I(A,f\,{}^{*\!\!}\mu)\ \ ?
  $$
\end{question}

\begin{theorem}[Radon-\breve Nikodym] 
  Let $\nu,\mu\in{\EuScript M}$ be such that $\nu\ll\mu$.
  Then there is an $f\in{\EuScript R}$ such that 
  $$
  \int_X f{\rm d}\mu = \int_X {\rm d}\nu
  $$
  for every $X\in{\EuScript A}$.
\end{theorem}

\begin{proof}
  ???????????????????
\end{proof}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \section{Completeness vs.\@ saturation\quad !` please expand !}

% The $A$-limit uniformity on $ M^{|x|}$ is the uniformity that has the following entourages 

% \ceq{\hfill V_{\varphi(x),\, \varepsilon}}{=}{\Big\{(a,b)\in  M^{|x|}\times  M^{|x|}\quad :\quad \big|\varphi^{\EuScript M}(a)-\varphi^{\EuScript M}(b)\big|<\varepsilon\Big\}}

% for $\varphi(x)\in L(A)$ and $\varepsilon\in{\mathds R}^+$. It is the coarsest uniformity that makes all formulas in $L(A)$ uniformly continuous.

% Let $p(x)\subseteq L( M)$ be a type.
% We say that $p(x)\le0$ is \emph{Cauchy\/} (in the $A$-limit uniformity) if for every $\varphi(x)\in L(A)$ and every $\varepsilon\in{\mathds R}^+$ there is a disjunction of formulas in $p(x)$, say $\psi(x)$, such that $\varnothing\neq\big(\psi( M)\le0\big)^2\subseteq V_{\varphi(x),\, \varepsilon}$.

% \begin{fact}
%   Let $\lambda=L(A)$.
%   If ${}^{\circ\!\!} M$ is $\lambda$-saturated then and $p(x)\subseteq L( M)$ is Cauchy, then $p(x)$ is realized in ${}^{\circ\!\!} M$.
% \end{fact}


% For every $\varphi(x)\in\ L(A)$ and $n\in{\mathds \breve N}$ let 


% Suppose ${\EuScript N}\models p(a)\le0$ and let $\big(\psi( M)\le0\big)^2\subseteq V_{\varphi(x),\, \varepsilon}$


\end{document}
